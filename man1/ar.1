.\" Copyright (c) 2007 Joseph Koshy.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" This software is provided by Joseph Koshy ``as is'' and
.\" any express or implied warranties, including, but not limited to, the
.\" implied warranties of merchantability and fitness for a particular purpose
.\" are disclaimed.  in no event shall Joseph Koshy be liable
.\" for any direct, indirect, incidental, special, exemplary, or consequential
.\" damages (including, but not limited to, procurement of substitute goods
.\" or services; loss of use, data, or profits; or business interruption)
.\" however caused and on any theory of liability, whether in contract, strict
.\" liability, or tort (including negligence or otherwise) arising in any way
.\" out of the use of this software, even if advised of the possibility of
.\" such damage.
.\"
.Dd 3 января 2022 г.
.Dt AR 1
.Os
.Sh ИМЯ
.Nm ar ,
.Nm ranlib
.Nd manage archives
.Sh СИНТАКСИС
.Nm
.Fl d
.Op Fl T
.Op Fl f
.Op Fl j
.Op Fl v
.Op Fl z
.Ar archive
.Ar
.Nm
.Fl m
.Op Fl T
.Op Fl a Ar position-after
.Op Fl b Ar position-before
.Op Fl f
.Op Fl i Ar position-before
.Op Fl j
.Op Fl s | Fl S
.Op Fl z
.Ar archive
.Ar
.Nm
.Fl p
.Op Fl T
.Op Fl f
.Op Fl v
.Ar archive
.Op Ar
.Nm
.Fl q
.Op Fl T
.Op Fl c
.Op Fl D
.Op Fl f
.Op Fl s | Fl S
.Op Fl U
.Op Fl v
.Op Fl z
.Ar archive
.Ar
.Nm
.Fl r
.Op Fl T
.Op Fl a Ar position-after
.Op Fl b Ar position-before
.Op Fl c
.Op Fl D
.Op Fl f
.Op Fl i Ar position-before
.Op Fl j
.Op Fl s | Fl S
.Op Fl u
.Op Fl U
.Op Fl v
.Op Fl z
.Ar archive
.Ar
.Nm
.Fl s
.Op Fl j
.Op Fl z
.Ar archive
.Nm
.Fl t
.Op Fl f
.Op Fl T
.Op Fl v
.Ar archive
.Op Ar
.Nm
.Fl x
.Op Fl C
.Op Fl T
.Op Fl f
.Op Fl o
.Op Fl u
.Op Fl v
.Ar archive
.Op Ar
.Nm
.Fl M
.Nm ranlib
.Op Fl D
.Op Fl U
.Ar archive ...
.Sh ОПИСАНИЕ
The
.Nm
утилита создает и поддерживает группы файлов, объединенные в
архив.
После создания архива в него можно добавлять новые файлы.
существующие файлы можно извлечь, удалить или заменить.
.Pp
Файлы в архиве именуются по последнему компоненту имени файла,
поэтому, если файл, на который ссылается путь, содержащий
.Dq /
заархивирован, ему будет присвоено имя по последнему компоненту пути.
Аналогично, при сопоставлении путей, перечисленных в командной строке, с
имена файлов, хранящиеся в архиве, только последняя составляющая
путь будет сравниваться.
.Pp
Обычное использование
.Nm
предназначен для создания и обслуживания библиотек, пригодных для использования
с редактором ссылок
.Xr ld 1 ,
хотя это не ограничивается этой целью.
The
.Nm
утилита может создавать и управлять таблицей символов архива(смотреть
.Xr ar 5 )
используется для ускорения операций редактирования ссылок.
Если в архиве присутствует таблица символов, она будет
поддерживается в актуальном состоянии посредством последующих операций с архивом.
.Pp
The
.Nm ranlib
утилита используется для добавления таблицы символов архива
в существующий архив
.Sh ПАРАМЕТРЫ
The
.Nm
утилита поддерживает следующие опции:
.Bl -tag -width indent
.It Fl a Ar member-afte
При использовании с опцией
.Fl m
эта опция указывает, что элементы архива, указанные параметром
аргументы
.Ar
перемещаются после элемента архива, указанного в аргументе
.Ar member-after .
При использовании с опцией
.Fl r
эта опция указывает, что файлы, указанные аргументами
.Ar
добавляются после элемента архива, указанного в аргументе
.Ar member-after .
.It Fl b Ar member-before
При использовании с опцией
.Fl m
эта опция указывает, что элементы архива, указанные параметром
аргументы
.Ar
перемещаются перед элементом архива, указанным в аргументе
.Ar member-before .
При использовании с опцией
.Fl r
эта опция указывает, что файлы, указанные аргументами
.Ar
добавляются перед элементом архива, указанным в аргументе
.Ar member-before .
.It Fl c
Подавить информационное сообщение, выводящееся при создании нового архива
созданный с использованием
.Fl r
и
.Fl q
параметры.
.It Fl C
Запретить замену извлеченных файлов файлами с одинаковыми именами
в файловой системе.
.It Fl d
Удалить члены, указанные в аргументах
.Ar
из архива, указанного аргументом
.Ar archive .
Таблица символов архива, если она присутствует, обновляется, чтобы отразить
новое содержимое архива.
.It Fl D
При использовании в сочетании с
.Fl r
или
.Fl q
вариант,
с
.Fl s
опция без других опций или при вызове как
.Nm ranlib ,
вставьте 0 вместо реальных значений mtime, uid и gid
и 0644 вместо файлового режима из членов, указанных в аргументах.
.Ar .
Это гарантирует воспроизводимость контрольных сумм полученных архивов.
когда содержимое членов идентично.
Эта опция включена по умолчанию.
Если несколько
.Fl D
и
.Fl U
параметры указываются в командной строке, последний имеет приоритет.
.It Fl f
Используйте только первые пятнадцать символов имени элемента архива или
Аргумент имени файла командной строки при именовании членов архива.
.It Fl i Ar member-before
Синоним слова опцион
.Fl b .
.It Fl j
Этот вариант принимается, но игнорируется.
.It Fl l
Этот вариант принят для совместимости с GNU
.Xr ar 1 ,
но игнорируется.
.It Fl m
Переместить элементы архива, указанные аргументами
.Ar
внутри архива.
Если позиция была указана одним из
.Fl a ,
.Fl b
или
.Fl i
параметры, элементы перемещаются до или после указанного
позиция.
Если позиция не указана, указанные элементы перемещаются.
до конца архива.
Если в архиве есть таблица символов, она обновляется с учетом
новое содержимое архива
.It Fl M
Чтение и выполнение команд библиотекаря МРТ со стандартного ввода.
Команды, понятные
.Nm
утилита описана в разделе
.Sx "MRI Librarian Commands" .
.It Fl o
Сохраняйте исходное время изменения элементов при извлечении.
их.
.It Fl p
Записать содержимое указанных членов архива, названных по
аргументы
.Ar
на стандартный вывод.
Если члены не были указаны, содержимое всех файлов в
архиве записываются в том порядке, в котором они появляются в архиве.
.It Fl q
Добавить файлы, указанные аргументами
.Ar
в архив, указанный аргументом
.Ar archive
без проверки наличия файлов в архиве.
Таблица символов архива будет обновляться по мере необходимости.
Если файл, указанный аргументом
.Ar archive
еще не существует, будет создан новый архив.
.It Fl r
Заменить (добавить) файлы, указанные аргументами
.Ar
в архиве, указанном аргументом
.Ar archive ,
создание архива при необходимости.
Замена существующих участников не изменит порядок участников внутри
архив.
Если файл, указанный в аргументах
.Ar
не существует, существующие элементы в архиве соответствуют этому
имя не изменено.
Новые файлы добавляются в конец архива, если только один из
варианты позиционирования
.Fl a ,
.Fl b
или
.Fl i
указано.
Таблица символов архива, если она существует, обновляется, чтобы отразить
новое состояние архива.
.It Fl s
Добавить таблицу символов архива(смотреть
.Xr ar 5 )
архив, указанный аргументом
.Ar archive .
Вызов
.Nm
с
.Fl s
сама по себе опция эквивалентна вызову
.Nm ranlib .
.It Fl S
Не создавайте таблицу символов архива.
.It Fl t
Перечислить файлы, указанные аргументами
.Ar
в том порядке, в котором они появляются в архиве, по одному в строке.
Если файлы не указаны, отображаются все файлы в архиве.
.It Fl T
Этот вариант принимается, но игнорируется.
В других реализациях
.Nm ,
.Fl T
создает «тонкий» архив.
.It Fl u
Условно обновить архив или извлечь участников.
При использовании с
.Fl r
опция, файлы, названные аргументами
.Ar
будут заменены в архиве, если они новее своих
архивные версии.
При использовании с
.Fl x
опция, члены, указанные аргументами
.Ar
будут извлечены только в том случае, если они новее соответствующих
файлы в файловой системе.
.It Fl U
При использовании в сочетании с
.Fl r
или
.Fl q
вариант, вставьте реальные значения mtime, uid и gid, а также режима файла.
от членов, названных аргументами
.Ar .
Если несколько
.Fl D
и
.Fl U
параметры указываются в командной строке, последний имеет приоритет.
.It Fl v
Обеспечьте подробный вывод.
При использовании с
.Fl d ,
.Fl m ,
.Fl q
или
.Fl x
параметры,
.Nm
дает пофайловое описание происходящей модификации архива
выполняется, который состоит из трех полей, разделенных пробелами:
буква выбора, тире
.Dq "-" ,
и имя файла.
При использовании с
.Fl r
вариант,
.Nm
отображает описание, как указано выше, но начальная буква — это
.Dq a
если файл добавлен в архив, или
.Dq r
если файл заменяет файл, уже находящийся в архиве.
При использовании с
.Fl p
опция, имя файла, заключенное в
.Dq <
и
.Dq >
символы записываются в стандартный вывод, которым предшествует одна новая строка
символ, за которым следуют два символа новой строки.
Содержимое именованного файла следует за именем файла.
При использовании с
.Fl t
вариант,
.Nm
отображает восемь полей, разделенных пробелами:
права доступа к файлу, отображаемые
.Xr strmode 3 ,
десятичные идентификаторы пользователей и групп, разделенные косой чертой (
.Dq / Ns ) ,
размер файла в байтах, время модификации файла в
.Xr strftime 3
формат
.Dq "%b %e %H:%M %Y" ,
и имя файла.
.It Fl V
Распечатайте строку версии и выйдите.
.It Fl x
Извлечь элементы архива, указанные аргументами
.Ar
в текущий каталог.
Если члены не указаны, извлеките все члены архива.
Если файл, соответствующий извлеченному элементу, не существует, он
будет создан.
Если файл, соответствующий извлеченному элементу, существует, его владелец
и группа не будет изменена, пока ее содержимое будет перезаписано
и его разрешения будут установлены на те, которые указаны в архиве.
Время доступа и изменения файла будет соответствовать времени
добычи, если только
.Fl o
был указан вариант.
.It Fl z
Этот вариант принимается, но игнорируется.
.El
.Ss "MRI Librarian Commands"
Если
.Fl M
указан вариант,
.Nm
Утилита будет читать и выполнять команды со своего стандартного ввода.
Если стандартный ввод представляет собой терминал,
.Nm
утилита отобразит подсказку
.Dq Li "AR >"
перед чтением строки и продолжит работу, даже если возникнут ошибки.
столкнулся.
Если стандартный ввод не является терминалом,
.Nm
утилита не будет отображать приглашение и прекратит выполнение
столкнулся с ошибкой.
.Pp
Каждая строка ввода содержит одну команду.
Слова во входной строке разделяются пробелами.
Первое слово строки — это команда, остальные слова —
аргументы команды.
Командное слово может быть указано в любом случае.
Аргументы могут быть разделены запятыми или пробелами.
.Pp
Пустые строки допускаются и игнорируются.
Длинные строки продолжаются, заканчивая их символом
.Dq Li +
характер.
.Pp
.Dq Li *
и
.Dq Li "\&;"
персонажи начинают комментарий.
Комментарии распространяются до конца строки.
.Pp
При выполнении сценария библиотекаря МРТ
.Nm
Утилита работает с временной копией архива.
Изменения в копии становятся постоянными с помощью
.Ic save
команда.
.Pp
Команды, понятные
.Nm
полезности:
.Bl -tag -width indent
.It Ic addlib Ar archive | Ic addlib Ar archive Pq Ar member Oo Li , Ar member Oc Ns ...
Добавить содержимое архива, указанного в аргументе
.Ar archive
в текущий архив.
Если конкретные члены названы с использованием аргументов
.Ar member ,
затем эти участники добавляются в текущий архив.
Если члены не указаны, все содержимое архива
добавляются в текущий архив.
.It Ic addmod Ar member Oo Li , Ar member Oc Ns ...
Добавьте файлы, названные аргументами
.Ar member
в текущий архив.
.It Ic clear
Удалить все содержимое текущего архива.
.It Ic create Ar archive
Создайте новый архив с именем, указанным в аргументе.
.Ar archive ,
и делает его текущим архивом.
Если указанный архив уже существует, он будет перезаписан.
когда
.Ic save
подается команда.
.It Ic delete Ar module Oo Li , Ar member Oc Ns ...
Удалите модули, указанные в аргументах.
.Ar member
из текущего архива.
.It Ic directory Ar archive Po Ar member Oo Li , Ar member Oc Ns ... Pc Op Ar outputfile
Перечислите каждый именованный модуль в архиве.
Формат вывода зависит от настройки детализации, установленной с помощью
тот
.Ic verbose
команда.
Вывод отправляется на стандартный вывод или в файл, указанный
аргумент
.Ar outputfile .
.It Ic end
Успешно выйти из
.Nm
утилиты.
Любые несохраненные изменения текущего архива будут отменены.
.It Ic extract Ar member Oo Li , Ar member Oc Ns ...
Извлеките члены, названные аргументами
.Ar member
из текущего архива.
.It Ic list
Отображение содержимого текущего архива в подробном виде.
.It Ic open Ar archive
Откройте архив, названный аргументом
.Ar archive
и сделайте его текущим архивом.
.It Ic replace Ar member Oo Li , Ar member Oc Ns ...
Заменить именованные элементы в текущем архиве указанными файлами.
по аргументам
.Ar member .
Файлы должны присутствовать в текущем каталоге и указанном имени.
модули уже должны существовать в текущем архиве.
.It Ic save
Зафиксировать все изменения в текущем архиве.
.It Ic verbose
Переключить уровень детализации
.Ic directory
команда.
.El
.Sh ПРИМЕРЫ
Чтобы создать новый архив
.Pa ex.a
содержащий три файла
.Pa ex1.o ,
.Pa ex2.o
и
.Pa ex3.o ,
использовать:
.Dl "ar -rc ex.a ex1.o ex2.o ex3.o"
.Pp
Чтобы добавить таблицу символов архива в существующий архив
.Pa ex.a ,
использовать:
.Dl "ar -s ex.a"
.Pp
Чтобы удалить файл
.Pa ex1.o
из архива
.Pa ex.a ,
использовать:
.D1 "ar -d ex.a ex1.o"
.Pp
Чтобы подробно перечислить содержимое архива
.Pa ex.a ,
использовать:
.D1 "ar -tv ex.a"
.Pp
Чтобы создать новый архив
.Pa ex.a
содержащий файлы
.Pa ex1.o ,
и
.Pa ex2.o ,
используя команды библиотекаря МРТ, используйте следующий сценарий:
.Bd -literal -offset indent
create ex.a		 * specify the output archive
addmod ex1.o ex2.o	 * add modules
save			 * save pending changes
end			 * exit the utility
.Ed
.Sh ДИАГНОСТИКА
.Ex -std
.Sh СМОТРИТЕ ТАКЖЕ
.Xr ld 1 ,
.Xr archive 3 ,
.Xr elf 3 ,
.Xr strftime 3 ,
.Xr strmode 3 ,
.Xr ar 5
.Sh СООТВЕТСТВИЕ СТАНДАРТАМ
The
.Nm
поддержка утилитой
.Fl a ,
.Fl b ,
.Fl c ,
.Fl i ,
.Fl m ,
.Fl p ,
.Fl q ,
.Fl r ,
.Fl s ,
.Fl t ,
.Fl u ,
.Fl v ,
.Fl C
и
.Fl T
варианты считаются соответствующими
.St -p1003.2 .
.Sh ИСТОРИЯ
An
.Nm
Команда впервые появилась в AT&T UNIX версии 1.
В
.Fx 8.0 ,
.An Kai Wang Aq Mt kaiw@FreeBSD.org
переопределен
.Nm
и
.Nm ranlib
используя
.Lb libarchive
и
.Lb libelf .