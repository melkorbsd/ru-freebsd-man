.\"	$NetBSD: grep.1,v 1.2 2011/02/16 01:31:33 joerg Exp $
.\"	$OpenBSD: grep.1,v 1.38 2010/04/05 06:30:59 jmc Exp $
.\" Copyright (c) 1980, 1990, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"	@(#)grep.1	8.3 (Berkeley) 4/18/94
.\"
.Dd 18 декабря 2022
.Dt GREP 1
.Os
.Sh НАЗВАНИЕ
.Nm grep ,
.Nm egrep ,
.Nm fgrep ,
.Nm rgrep
.Нд утилита поиска шаблонов в файлах
.Sh СИНТАКСИС
.Nm grep
.Bk -words
.Op Fl abcdDEFGHhIiLlmnOopqRSsUVvwxz
.Op Fl A Ar num
.Op Fl B Ar num
.Op Fl C Ar num
.Op Fl e Ar шаблон
.Op Fl f Ar файл
.Op Fl Fl binary-files= Ns Ar значение
.Op Fl Fl color Ns Op Cm = Ns Ar когда
.Op Fl Fl colour Ns Op Cm = Ns Ar когда
.Op Fl Fl context= Ns Ar num
.Op Fl Fl label
.Op Fl Fl line-buffered
.Op Fl Fl null
.Op Ar шаблон
.Op Ar
.Ek
.Sh ОПИСАНИЕ
Утилита
.Nm grep
ищет строки в указанных файлах ввода,
соответствующие одному или более шаблонам.
По умолчанию, строка считается соответствующей,
если регулярное выражение
.RE (шаблон) соответствует строке ввода
без завершающего перевода строки.
Пустое выражение соответствует каждой строке.
Каждая строка ввода, которая соответствует хотя бы
одному из шаблонов, записывается в стандартный вывод.
.Pp
.Nm grep
используется для простых шаблонов и основных
регулярных выражений
.Pq BRE ;
.Nm egrep
может обрабатывать расширенные регулярные выражения
.Pq ERE .
См.
.Xr re_format 7
для получения дополнительной информации о
регулярных выражениях.
.Nm fgrep
работает быстрее, чем
.Nm grep
и
.Nm egrep ,
но может обрабатывать только фиксированные шаблоны
(т.е. не интерпретирует регулярные выражения).
Шаблоны могут состоять из одной или нескольких
строк, позволяя любому из строк шаблонов
соответствовать части ввода.
.Pp
Доступны следующие параметры:
.Bl -tag -width indent
.It Fl A Ar num , Fl Fl after-context= Ns Ar num
Вывести
.Ar num
строк контекста после каждой совпадающей строки.
См. также параметры
.Fl B
и
.Fl C .
.It Fl a , Fl Fl text
Рассматривать все файлы как текстовые файлы ASCII.
Обычно
.Nm
просто выводит
.Dq Binary file ... matches
если файлы содержат двоичные символы.
Использование этого параметра заставляет
.Nm
выводить строки, соответствующие указанному шаблону.
.It Fl B Ar num , Fl Fl before-context= Ns Ar num
Вывести
.Ar num
строк контекста до каждой совпадающей строки.
См. также параметры
.Fl A
и
.Fl C .
.It Fl b , Fl Fl byte-offset
Смещение в байтах найденного шаблона отображается
перед соответствующей строкой.
.It Fl C Ar num , Fl Fl context= Ns Ar num
Вывести
.Ar num
строк контекста до и после каждой совпадающей строки.
См. также параметры
.Fl A
и
.Fl B .
.It Fl c , Fl Fl count
Только количество выбранных строк выводится в
стандартный вывод.
.It Fl Fl colour= Ns Oo Ar когда Oc , Fl Fl color= Ns Oo Ar когда Oc
Выделить текст, соответствующий шаблону, с использованием
выражения,  сохранённого в переменной окружения 
.Ev GREP_COLOR .
Возможные значения параметра 
.Ar когда 
это 
.Dq Cm never ,
.Dq Cm always 
и 
.Dq Cm auto .
.It Fl D Ar действие , Fl Fl devices= Ns Ar действие
Указать требуемое 
.Ar действие 
для устройств, FIFO и сокетов.
По умолчанию 
.Ar действие 
это 
.Dq Cm read ,
что означает, что они читаются как обычные файлы.
Если параметр 
.Ar действие 
установлен на 
.Dq Cm skip ,
устройства пропускаются без вывода сообщений.
.It Fl d Ar действие , Fl Fl directories= Ns Ar действие
Указать требуемое 
.Ar действие 
для каталогов.
По умолчанию это 
.Dq Cm read ,
что означает, что каталоги читаются как обычные файлы.
Другие возможные значения — 
.Dq Cm skip 
для тихого пропуска каталогов, и 
.Dq Cm recurse 
для рекурсивного чтения, что аналогично параметрам 
.Fl R 
и 
.Fl r .
.It Fl E , Fl Fl extended-regexp
Интерпретировать 
.Ar шаблон 
как расширенное регулярное выражение 
(i.e., заставить 
.Nm grep 
работать как 
.Nm egrep ) .
.It Fl e Ar шаблон , Fl Fl regexp= Ns Ar шаблон
Указать 
.Ar шаблон ,
используемый при поиске в файле ввода:
строка ввода выбирается, если она соответствует
любому из указанных шаблонов. Этот параметр особенно
полезен, когда используется несколько параметров 
.Fl e 
для указания нескольких шаблонов,
или если 
.Ar шаблон 
начинается с дефиса 
.Pq Sq - .
.It Fl Fl exclude Ar шаблон
Если указано, исключает файлы, имена которых
соответствуют указанному  шаблону 
.Ar шаблон 
из поиска.
Обратите внимание, что шаблоны 
.Fl Fl exclude 
и 
.Fl Fl include 
обрабатываются в порядке, в котором они даны.
Если имя совпадает с несколькими шаблонами,
применяется последнее совпавшее правило.
Если шаблон 
.Fl Fl include 
не указан, будут искаться все файлы, не исключённые.
Шаблоны применяются ко всему указанному пути, а не
только к имени файла.
.It Fl Fl exclude-dir Ar шаблон
Если указан параметр 
.Fl R ,
каталоги, имена которых соответствуют заданному шаблону 
.Ar шаблон ,
исключаются из поиска.
Обратите внимание, что шаблоны 
.Fl Fl exclude-dir 
и 
.Fl Fl include-dir 
обрабатываются в порядке, в котором они даны.
Если имя совпадает с несколькими шаблонами,
применяется последнее совпавшее правило.
Если шаблон 
.Fl Fl include-dir 
не указан, будут искаться все каталоги, не исключённые.
.It Fl F , Fl Fl fixed-strings
Интерпретировать 
.Ar шаблон 
как набор фиксированных строк
(i.e., заставить 
.Nm grep 
работать как 
.Nm fgrep ) .
.It Fl f Ar файл , Fl Fl file= Ns Ar файл
Читать один или несколько шаблонов, разделённых
символами новой строки, из 
.Ar файла .
Пустые строки шаблонов соответствуют каждой строке ввода.
Символы новой строки не рассматриваются как часть шаблона.
Если 
.Ar файл 
пуст, ничего не будет найдено.
.It Fl G , Fl Fl basic-regexp
Интерпретировать 
.Ar шаблон 
как основное регулярное выражение 
(i.e., заставить 
.Nm grep 
работать как традиционный 
.Nm grep ) .
.It Fl H
Всегда выводить имена файлов вместе со строками вывода.
.It Fl h , Fl Fl no-filename
Никогда не выводить имена файлов
.Pq i.e., имена файлов
вместе со строками вывода.
.It Fl Fl help
Вывести краткое сообщение о помощи.
.It Fl I
Игнорировать двоичные файлы.
Этот параметр эквивалентен параметру 
.Dq Fl Fl binary-files= Ns Cm without-match .
.It Fl i , Fl Fl ignore-case
Игнорировать регистр при сопоставлении.
По умолчанию, 
.Nm grep 
чувствителен к регистру.
.It Fl Fl include Ar шаблон
Если указано, искать только файлы, имена которых
соответствуют указанному шаблону 
.Ar шаблон .
Обратите внимание, что шаблоны 
.Fl Fl include 
и 
.Fl Fl exclude 
обрабатываются в порядке, в котором они даны.
Если имя совпадает с несколькими шаблонами,
применяется последнее совпавшее правило.
Шаблоны применяются ко всему указанному пути,
а не только к имени файла.
.It Fl Fl include-dir Ar шаблон
Если указан параметр 
.Fl R ,
искать только каталоги, имена которых соответствуют
указанному шаблону 
.Ar шаблон .
Обратите внимание, что шаблоны 
.Fl Fl include-dir 
и 
.Fl Fl exclude-dir 
обрабатываются в порядке, в котором они даны.
Если имя совпадает с несколькими шаблонами,
применяется последнее совпавшее правило.
.It Fl L , Fl Fl files-without-match
Выводить только имена файлов, не содержащих строк,
соответствующих шаблону. Имена файлов выводятся один
раз для каждого обрабатываемого файла. Если в качестве
ввода используется стандартный поток, выводится строка 
.Dq (standard input) ,
если не указан параметр 
.Fl Fl label .
.It Fl l , Fl Fl files-with-matches
Выводить только имена файлов, содержащих строки,
соответствующие шаблону.
.Nm grep 
будет искать в файле только до тех пор, пока не будет
найдено совпадение, что может уменьшить затраты
на поиск. Имена файлов выводятся один раз для каждого
обрабатываемого файла. Если в качестве ввода
используется стандартный поток, выводится строка 
.Dq (standard input) ,
если не указан параметр 
.Fl Fl label .
.It Fl Fl label
Метка для использования вместо строки 
.Dq (standard input)
для имени файла, если имя файла обычно выводится.
Этот параметр применяется к параметрам 
.Fl H ,
.Fl L 
и 
.Fl l .
.It Fl Fl mmap
Использовать 
.Xr mmap 2
вместо 
.Xr read 2
для чтения ввода, что может повысить производительность
в некоторых случаях, но может привести к неопределённому
поведению.
.It Fl m Ar num , Fl Fl max-count= Ns Ar num
Прекратить чтение файла после 
.Ar num
совпадений.
.It Fl n , Fl Fl line-number
Каждая строка вывода предваряется её относительным
номером строки в файле, начиная с строки 1.
Счётчик строк сбрасывается для каждого обрабатываемого
файла. Этот параметр игнорируется, если указаны параметры 
.Fl c ,
.Fl L ,
.Fl l 
или 
.Fl q .
.It Fl Fl null
Выводить байт нулевого значения после имени файла.
.It Fl O
Если указан параметр 
.Fl R ,
следовать символическим ссылкам только в том случае,
если они были явно указаны в командной строке.
По умолчанию символические ссылки не отслеживаются.
.It Fl o , Fl Fl only-matching
Выводить только совпадающие части строк.
.It Fl p
Если указан параметр 
.Fl R ,
символические ссылки не отслеживаются.
Это значение используется по умолчанию.
.It Fl q , Fl Fl quiet , Fl Fl silent
Тихий режим:
подавляет стандартный вывод.
.Nm grep 
будет искать в файле только до тех пор, пока не
будет найдено совпадение, что может уменьшить
затраты на поиск.
.It Fl R , Fl r , Fl Fl recursive
Рекурсивно искать в перечисленных подкаталогах
(i.e., заставить
.Nm grep
работать как
.Nm rgrep ) .
.It Fl S
Если указан параметр
.Fl R ,
следовать всем символическим ссылкам.
По умолчанию символические ссылки не отслеживаются.
.It Fl s , Fl Fl no-messages
Тихий режим.
Несуществующие и недоступные для чтения файлы игнорируются
(i.e., их сообщения об ошибках подавляются).
.It Fl U , Fl Fl binary
Искать в двоичных файлах, но не пытаться их выводить.
.It Fl u
Этот параметр не имеет эффекта и предоставляется только для
совместимости с GNU grep.
.It Fl V , Fl Fl version
Показать информацию о версии и завершить выполнение.
.It Fl v , Fl Fl invert-match
Выбираются строки, которые
.Em не
соответствуют ни одному из указанных шаблонов.
.It Fl w , Fl Fl word-regexp
Искать выражение как слово (будто окружённое
.Sq [[:<:]]
и
.Sq [[:>:]] ;
см.
.Xr re_format 7 ) .
Этот параметр не имеет эффекта, если также указан параметр
.Fl x .
.It Fl x , Fl Fl line-regexp
Выбираются только те строки ввода, которые полностью
соответствуют фиксированной строке или регулярному
выражению.
.It Fl y
Эквивалентно
.Fl i .
Устаревший.
.It Fl z , Fl Fl null-data
Рассматривать входные и выходные данные как
последовательности строк, разделённые нулевым
байтом вместо новой строки.
.It Fl Fl binary-files= Ns Ar значение
Контролирует поиск и вывод двоичных файлов.
Варианты:
.Bl -tag -compact -width "binary (default)"
.It Cm binary No (по умолчанию)
Искать в двоичных файлах, но не выводить их.
.It Cm without-match
Не искать в двоичных файлах.
.It Cm text
Рассматривать все файлы как текст.
.El
.It Fl Fl line-buffered
Принудительно использовать построчный буфер для вывода.
По умолчанию вывод буферизуется построчно, если
стандартный вывод является терминалом,
и блоками в противном случае.
.El
.Pp
Если аргументы файла не указаны, используется
стандартный ввод. Дополнительно, вместо имени
файла можно использовать
.Dq Cm -
, в любом месте, где допустимо имя файла, для
чтения со стандартного ввода.
Это включает как аргументы параметра
.Fl f ,
так и аргументы файла.
.Sh ОКРУЖЕНИЕ
Следующие переменные окружения влияют на выполнение
.Nm :
.Bl -tag -width "GREP_OPTIONS"
.It Ev GREP_COLOR
Эта переменная указывает цвет, используемый для
выделения соответствующего (не пустого) текста.
.It Ev GREP_OPTIONS
Эта переменная указывает параметры по умолчанию,
которые будут размещены перед любыми явно заданными
параметрами. Она может вызывать проблемы с
переносимыми сценариями.
.It Ev TERM
Эта переменная указывает тип терминала, консоли или
устройства отображения, который будет использоваться.
См.
.Xr term 7 .
.El
.Sh КОД ЗАВЕРШЕНИЯ
Утилита
.Nm grep
завершается с одним из следующих значений:
.Pp
.Bl -tag -width flag -compact
.It Li 0
Найдена одна или более строк.
.It Li 1
Строки не найдены.
.It Li \*(Gt1
Произошла ошибка.
.El
.Sh ПРИМЕРЫ
.Bl -dash
.It
Найти все вхождения шаблона
.Sq patricia
в файле:
.Pp
.Dl $ grep 'patricia' myfile
.It
То же самое, но искать только полные слова:
.Pp
.Dl $ grep -w 'patricia' myfile
.It
Подсчитать количество вхождений точного шаблона
.Sq FOO
:
.Pp
.Dl $ grep -c FOO myfile
.It
То же самое, но без учёта регистра:
.Pp
.Dl $ grep -c -i FOO myfile
.It
Найти все вхождения шаблона
.Ql .Pp
в начале строки:
.Pp
.Dl $ grep '^\e.Pp' myfile
.Pp
Апострофы обеспечивают, что
всё выражение обрабатывается
.Nm grep ,
а не оболочкой пользователя.
Символ каретки
.Ql ^
соответствует пустой строке в начале строки,
а
.Ql \e
экранирует символ
.Ql \&. ,
который в противном случае соответствует любому символу.
.It
Найти все строки в файле, которые не содержат слов
.Sq foo
или
.Sq bar :
.Pp
.Dl $ grep -v -e 'foo' -e 'bar' myfile
.It
Просмотреть файл
.Sq calendar ,
ищущий строки 19, 20 или 25 с использованием расширенных
регулярных выражений:
.Pp
.Dl $ egrep '19|20|25' calendar
.It
Показать совпадающие строки и имена файлов
.Sq *.h ,
которые содержат шаблон
.Sq FIXME .
Выполнить поиск рекурсивно, начиная с каталога
.Pa /usr/src/sys/arm
.Pp
.Dl $ grep -H -R FIXME --include="*.h" /usr/src/sys/arm/
.It
То же самое, но показать только имя файла:
.Pp
.Dl $ grep -l -R FIXME --include="*.h" /usr/src/sys/arm/
.It
Показать строки, содержащие текст
.Sq foo .
Совпадающая часть вывода выделяется цветом, и каждая строка
предваряется номером строки и смещением в файле для этих строк,
соответствующих шаблону.
.Pp
.Dl $ grep -b --colour -n foo myfile
.It
Показать строки, которые соответствуют расширенным
регулярным выражениям, считанным из стандартного ввода:
.Pp
.Dl $ echo -e 'Free\enBSD\enAll.*reserved' | grep -E -f - myfile
.It
Показать строки из вывода команды
.Xr pciconf 8 ,
которые соответствуют указанному расширенному регулярному
выражению вместе с тремя строками контекста до и одной
строкой контекста после:
.Pp
.Dl $ pciconf -lv | grep -B3 -A1 -E 'class.*=.*storage'
.It
Подавить вывод и использовать код выхода для вывода
соответствующего сообщения:
.Pp
.Dl $ grep -q foo myfile && echo File matches
.El
.Sh СМ. ТАКЖЕ
.Xr ed 1 ,
.Xr ex 1 ,
.Xr sed 1 ,
.Xr zgrep 1 ,
.Xr re_format 7
.Sh СТАНДАРТЫ
Утилита
.Nm
соответствует спецификации
.St -p1003.1-2008 .
.Pp
Флаги
.Op Fl AaBbCDdGHhILmopRSUVw
являются расширениями этой спецификации, и поведение
параметров
.Fl f
при использовании с пустым файлом шаблонов не определено.
.Pp
Все длинные параметры предоставлены для совместимости с
GNU-версиями этой утилиты.
.Pp
Исторические версии утилиты
.Nm grep
также поддерживали флаги
.Op Fl ruy .
Эта реализация поддерживает эти параметры;
однако их использование крайне не рекомендуется.
.Sh ИСТОРИЯ
Команда
.Nm grep
впервые появилась в
.At v6 .
