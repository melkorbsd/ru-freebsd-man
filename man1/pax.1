.\"-
.\" Copyright (c) 1992 Кит Мюллер.
.\" Copyright (c) 1992, 1993
.\"	Ректоры Калифорнийского университета. Все права защищены.
.\"
.\" Этот код основан на программном обеспечении, предоставленном в Беркли
.\" Китом Миллером из Калифорнийского университета в Сан-Диего.
.\"
.\" Распространение и использование в исходном коде и двоичной форме, с использованием или без использования
.\" модификаций, если следующие условия
.\" соблюдаются:
.\" 1. При распространении исходного кода должно сохраняться вышеуказанное уведомление
.\"    об авторских правах, этот список условий и следующий дисклеймер.
.\" 2. При распространиении в двоичной форме должно воспроизводиться уведомление об авторских правах,
.\"    этот список условий и следующий ниже отказ от ответственности в
.\"    документации и/или других материалах, поставляемых с дистрибутивом.
.\" 3. Ни название университета, ни имена его участников не могут быть использованы для
.\"    поддержки или продвижения продуктов, созданных на основе данного программного обеспечения,
.\"    без специального предварительного письменного согласия.
.\"
.\" ДАННОЕ ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ ПРЕДОСТАВЛЯЕТСЯ ПРАВООБЛАДАТЕЛЯМИ И СОАВТОРАМИ ``КАК ЕСТЬ'', И 
.\" МЫ ОТКАЗЫВАЕМСЯ ОТ ЛЮБЫХ ПОДРАЗУМЕВАЕМЫХ ОБЯЗАТЕЛЬСТВ, ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ, 
.\" ПОДРАЗУМЕВАЕМЫЕ ГАРАНТИИ ТОВАРНОЙ ПРИГОДНОСТИ И НЕПРИГОДНОСТИ ДЛЯ ОПРЕДЕЛЕННОЙ
.\" ЦЕЛИ. НИ В КОЕМ СЛУЧАЕ ПРАВООБЛАДАТЕЛИ ИЛИ СОВАТОРЫ НЕ НЕСУТ ОТВЕТСТВЕННОСТИ
.\" ЗА ЛЮБЫЕ ПРЯМЫЕ, КОСВЕННЫЕ, СЛУЧАЙНЫЕ, ОСОБЫЕ, ПОКАЗАТЕЛЬНЫЕ ИЛИ ЛОГИЧЕСКИ ВЫТЕКАЮЩИЕ
.\" УБЫТКИ (ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ ИМИ, ПРИОБРЕТЕНИЕ ЗАМЕНЯЮЩИХ ТОВАРОВ ИЛИ УСЛУГ;
.\" ПОТЕРЮ ВОЗМОЖНОСТИ ИСПОЛЬЗОВАНИЯ, ДАННЫХ ИЛИ ПРИБЫЛИ; ИЛИ ПРЕКРАЩЕНИЕ ДЕЯТЕЛЬНОСТИ)
.\" НЕЗАВИСИМО ОТ ПРИЧИНЕННОГО УЩЕРБА И НА ОСНОВАНИИ ЛЮБОЙ ТЕОРИИ ОТВЕТСТВЕННОСТИ, БУДЬ ТО В РАМКАХ КОНТРАКТА, 
.\" ПРЯМОЙ ОТВЕТСТВЕННОСТИ ИЛИ ДЕЛИКТА (ВКЛЮЧАЯ ХАЛАТНОСТЬ ИЛИ ИНОЕ), ВОЗНИКШЕГО КАКИМ-ЛИБО ОБРАЗОМ
.\" В РЕЗУЛЬТАТЕ ИСПОЛЬЗОВАНИЯ ДАННОГО ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ, ДАЖЕ ЕСЛИ ВЫ БЫЛИ ОСВЕДОМЛЕНЫ О ВОЗМОЖНОСТИ
.\" ТАКОГО УЩЕРБА.
.\"
.\"	  @(#)pax.1	8.4 (Berkeley) 4/18/94
.\"
.Dd 19 октября, 2022 год
.Dt PAX 1
.Os
.Sh НАЗВАНИЕ
.Nm pax
.Nd read and write file archives and copy directory hierarchies
.Sh СИНТКАСИС
.Nm
.Op Fl cdnvzO
.Bk -words
.Op Fl f Ar архив
.Ek
.Bk -words
.Op Fl s Ar строка_замены
.Ar ...\&
.Ek
.Bk -words
.Op Fl U Ar пользователь
.Ar ...\&
.Ek
.Bk -words
.Op Fl G Ar группа
.Ar ...\&
.Ek
.Bk -words
.Oo
.Fl T
.Op Ar от_даты
.Op Ar ,до_даты
.Oc
.Ar ...\&
.Ek
.Op Ar шаблон ...\&
.Nm
.Fl r
.Op Fl cdiknuvzDOYZ
.Bk -words
.Op Fl f Ar архив
.Ek
.Bk -words
.Op Fl o Ar опции
.Ar ...\&
.Ek
.Bk -words
.Op Fl p Ar строка
.Ar ...\&
.Ek
.Bk -words
.Op Fl s Ar строка_замены
.Ar ...\&
.Ek
.Op Fl E Ar предел
.Bk -words
.Op Fl U Ar пользователь
.Ar ...\&
.Ek
.Bk -words
.Op Fl G Ar группа
.Ar ...\&
.Ek
.Bk -words
.Oo
.Fl T
.Op Ar от_даты
.Op Ar ,до_даты
.Oc
.Ar ...\&
.Ek
.Op Ar шаблон ...\&
.Nm
.Fl w
.Op Fl dituvzHLOPX
.Bk -words
.Op Fl b Ar размер_блока
.Ek
.Oo
.Op Fl a
.Op Fl f Ar архив
.Oc
.Bk -words
.Op Fl x Ar формат
.Ek
.Bk -words
.Op Fl s Ar строка_замены
.Ar ...\&
.Ek
.Bk -words
.Op Fl o Ar опции
.Ar ...\&
.Ek
.Bk -words
.Op Fl U Ar пользователь
.Ar ...\&
.Ek
.Bk -words
.Op Fl G Ar группа
.Ar ...\&
.Ek
.Bk -words
.Op Fl B Ar байты
.Ek
.Bk -words
.Oo
.Fl T
.Op Ar от_даты
.Op Ar ,до_даты
.Op Ar /[c][m]
.Oc
.Ar ...\&
.Ek
.Op Ar
.Nm
.Fl r
.Fl w
.Op Fl diklntuvDHLOPXYZ
.Bk -words
.Op Fl p Ar строка
.Ar ...\&
.Ek
.Bk -words
.Op Fl s Ar строка_замены
.Ar ...\&
.Ek
.Bk -words
.Op Fl U Ar пользователь
.Ar ...\&
.Ek
.Bk -words
.Op Fl G Ar группа
.Ar ...\&
.Ek
.Bk -words
.Oo
.Fl T
.Op Ar от_даты
.Op Ar ,до_даты
.Op Ar /[c][m]
.Oc
.Ar ...\&
.Ek
.Op Ar
.Ar директория
.Sh ОПИСАНИЕ
Утилита
.Nm
будет считывать, записывать и выводить список элементов архивного файла,
а также копировать иерархии директорий.
Эти операции не зависят от конкретного формата архива
и поддерживают широкий спектр различных архивных форматов.
Список поддерживаемых форматов архивов можно найти у опции
.Fl x 
в описании.
.Pp
Наличие опций
.Fl r
и
.Fl w
определяет, в каком из следующих функциональных режимов
.Nm
будет работать:
.Em list , read , write ,
и
.Em copy .
.Bl -tag -width 6n
.It <none>
.Em List .
Записывает в
.Dv standard output
оглавление элементов архивного файла, считанного из
.Dv standard input ,
чьи имена путей совпадают с указанными
.Ar шаблоны .
Оглавление содержит по одному имени файла в строке
и записывается с использованием однострочной буферизации.
.It Fl r
.Em Read .
Извлекает элементы архивного файла, считанные из
.Dv standard input ,
с именами путей , совпадающими с
.Ar шаблоны .
Формат архива и блокирование автоматически определяются при вводе.
Когда извлеченный файл является директорией, извлекается вся файловая иерархия,
находящаяся в этой директории.
Все извлеченные файлы создаются относительно текущей файловой иерархии.
Настройка владения, времени доступа и модификации, а также файлового режима
извлеченных файлов более подробно обсуждаются в разделе
.Fl p
разделе.
.It Fl w
.Em Write .
Саписывает архив, содержащий операнды
.Ar файл
в
.Dv standard output
используя указанный формат архива.
Когда нет
.Ar файл
операнды задаются, список файлов для копирования с одной на каждой строке считывается из
.Dv standard input .
Когда операнд
.Ar file
также является директорией, будет включена вся файловая иерархия,
размещенная в этой директории.
.It Fl r Fl w
.Em Copy .
Копирует операнды
.Ar файл
в целевую
.Ar директория .
Когда операнды
.Ar файл
не указаны, список файлов для копирования, по одному на строку, считывается
из
.Dv standard input .
Когда операнд
.Ar файл
также является директорией, будет включена вся файловая
иерархия, размещенная в этой директории.
Эффект от
.Em copy
выглядит так, как если бы скопированные файлы были записаны в архивный файл,
а затем извлечены, за исключением того, что между
оригиналом и скопированными файлами могут быть жесткие связи (смотрите опцию
.Fl l
ниже).
.Pp
.Em Предупреждение :
Итоговая
.Ar директория
не должна быть одним из операндов
.Ar файл
или членом файловой иерархии, имеющей руты в одном из
.Ar файл
операндов.
Результат
.Em copy
в этих условиях непредсказуем.
.El
.Pp
При обработке поврежденного архива во время
.Em read
или
.Em list
операций,
.Nm
попытается устранить дефекты носителя и выполнит поиск в архиве,
чтобы найти и обработать как можно большее количество элементов архива (смотрите в опции
.Fl E
более подробную информацию об обработке ошибок).
.Sh ОПЕРАНДЫ
Операнд
.Ar дирекория
указывает имя пути к целевой директории.
Если операнд
.Ar директория
если файл не существует, или он недоступен для записи пользователем,
или он не относится к типу директории,
.Nm
завершит работу с ненулевым статусом завершения.
.Pp
Операнд
.Ar шаблон
операнд используется для выбора одного или нескольких путей к элементам архива.
Элементы архива выбираются с использованием обозначения соответствия шаблону, описанного
в
.Xr fnmatch 3 .
Когда операнд
.Ar шаблон
не указан, будут выбраны все элементы архива.
Когда
.Ar шаблон
совпадает с каталогом, вся файловая иерархия, размещенная в этой директории,
будет выбрана.
Когда операнд
.Ar шаблон
выбирает хотя бы один элемент архива,
.Nm
запишет эти операнды
.Ar шаблон
 в диагностическом сообщении для
.Dv standard error
а затем завершает работу с ненулевым статусом завершения.
.Pp
Операда
.Ar файл
указывает путь к файлу, который будет скопирован или заархивирован.
Когда операнд
.Ar файл
не выбирает хотя бы один элемент архива,
.Nm
запишет эти пути к операндам
.Ar файл
в диагностическом сообщении для
.Dv standard error
а затем завершает работу с ненулевым статусом завершения.
.Sh ОПЦИИ
Поддерживаются следующие опции:
.Bl -tag -width 4n
.It Fl r
Считывает архивный файл из
.Dv standard input
и извлекает указанные
.Ar файлы .
Если какие-либо промежуточные директории требуются для извлечения элемента 
архива, эти каталоги будут созданы так, как если бы
.Xr mkdir 2
вызывался с побитовым вкючением
.Dv OR
из
.Dv S_IRWXU , S_IRWXG ,
и
.Dv S_IRWXO
в качестве аргумент режима.
Если выбранный формат архива поддерживает спецификацию связанных
файлов и эти файлы не могут быть связаны во время извлечения архива,
.Nm
запишет диагностическое сообщение в
.Dv standard error
и завершит работу с ненулевым статусом завершения операции.
.It Fl w
Записывает файлы в
.Dv standard output
в указанном архвном формате.
Когда операнды файла
.Ar файл
не указаны,
.Dv standard input
считывается как список имен путей, по одному на строку, без каких-либо начальных или
завершающих
.Aq blanks .
.It Fl a
Добавляет
.Ar файлы
в конец архива, который был записан ранее.
Если формат архива не указан с помощью опции
.Fl x ,
будет выбран формат, используемый в архиве в данный момент.
Любая попытка добавить что-либо в архив в формате, отличном от
формата, уже используемого в архиве, приведет к тому, что
.Nm
немедленно завершит работу
с ненулевым статусом завершения.
Размер блока, используемый в архивном томе, где начинается запись,
будет продолжать использоваться для остальной части этого архивного тома 
.Pp
.Em Предупреждение :
Многие устройства хранения данных не способны поддерживать операции, необходимые
для выполнения операции добавления.
Любая попытка добавить что-либо к архиву, хранящемуся на таком устройстве, может привести к повреждению
архива или другим непредсказуемым результатам.
В частности, ленточные накопители с большей вероятностью не будут поддерживать операцию добавления.
Архив, хранящийся в обычном файле файловой системы или на дисковом устройстве,
обычно поддерживает операцию добавления.
.It Fl b Ar размер_блока
Когда
.Em writing
создает архив,
Блокирует вывод с положительным десятичным целым числом
байт на каждую запись в архивный файл.
Размер
.Ar размер_блока
должен быть кратен 512 байтам, но не более 64512 байт.
Размер
.Ar размер_блока
более 32256 байт нарушает стандарт
.Tn POSIX
и не будетсовместим со всеми системами.
аргумент
.Ar размер_блока
может заканчиваться на
.Li k
или
.Li b ,
чтобы указать умножение на 1024 (1K) или 512 соответственно.
Пара
.Ar размеры_блоков
может быть разделена
.Li x
для обозначения продукта.
Конкретное архивирующее устройство может налагать дополнительные ограничения на размер
поддерживаемой им блокировки.
Если блокировка не указана, значение по умолчанию
.Ar размер_блока
зависит от используемого конкретного формата архива (смотрите
.Fl x
опцию).
.It Fl c
Сопоставляет все элементы файла или архива
.Em except
с теми, которые указаны в 
.Ar шаблон
и
.Ar файл
операндами.
.It Fl d
Заставляет копируемые или архивируемые файлы типа директории или извлекаемые элементы 
архива типа директории соответствовать только файлу директории или
элементу архива, а не файловой иерархии, размещенной в директории.
.It Fl f Ar архив
Указывает
.Ar архив
в качестве пути к входному или выходному архиву, переопределяя стандартный
.Dv standard input
(для
.Em список
и
.Em read )
или
.Dv standard output
(для
.Em write ) .
Один архив может содержать несколько файлов на разных архивных устройствах.
При необходимости,
.Nm
запросит путь к файлу или устройству следующего тома в
архиве.
.It Fl i
Интерактивно переименовывает файлоы или элементоы архива.
Для каждого элемента архива, соответствующего операнду
.Ar шаблон
или для каждого файла, соответствующего
.Ar файл
операнду,
.Nm
запросит у
.Pa /dev/tty
его имя файла, файловый режим и время изменения.
The
.Nm
затем утилита считывает строку из
.Pa /dev/tty .
Если эта строка пуста, то элемент файла или архива пропускается.
Если эта строка состоит из одной точки,
то элемент файла или архива обрабатывается без изменения его имени.
В противном случае его название заменяется содержимым строки.
Утилита
.Nm
немедленно завершит работу с ненулевым статусом завершения, если
.Dv <EOF>
встречается при чтении ответа или если
.Pa /dev/tty
не может быть открыт для чтения и записи.
.It Fl k
Не перезаписывает существующие файлы.
.It Fl l
Связывает файлы.
(Буква ell).
В
.Em copy ,
режиме
.Pq Fl r w ,
устанавливаются жесткие связи между исходной и целевой файловыми иерархиями,
когда то возможно.
.It Fl n
Выберите первый элемент архива, соответствующий каждому
.Ar шаблон
операнду.
Сопоставляется не более одного элемента архива для каждого
.Ar шаблон .
Когда сопоставляются элементы типа директории, также сопоставляется файловая иерархия, корневая в этом
каталоге (если только
.Fl d
также не указан).
.It Fl o Ar опции
Информация для модификации алгоритма извлечения или записи архивных файлов,
характерного для формата архива, указанного
.Fl x .
В целом,
.Ar опции
принимаtn следующий вид:
.Cm name=value
.It Fl p Ar строка
Указывает один или несколько опций характеристик файла (привилегий).
Аргумент-опция
.Ar строка
это строка, указывающая характеристики файла, которые должны быть сохранены или
удалены при извлечении.
Строка состоит из символов спецификации
.Cm a , e , m , o ,
и
.Cm p .
В одной строке можно объединить несколько характеристик
и несколько опций
.Fl p
может быть указано.
Значения символов спецификации следующие:
.Bl -tag -width 2n
.It Cm a
Не сохраняет время доступа к файлам.
По умолчанию время доступа к файлам сохраняется, когда это возможно.
.It Cm e
.Sq Preserve everything ,
пользовательский ID, ID группы, биты режима
файла, время доступа к файлу и время изменения файла.
Это предназначено для использования
.Em root ,
кем-то, обладающим всеми необходимыми привилегиями, чтобы сохранить все
аспекты файлов в том виде, в каком они записаны в архиве.
Флаг
.Cm e
это сумма значений
.Cm o
и
.Cm p
флагов.
.It Cm m
Не сохраняет время изменения файла.
По умолчанию время изменения файла сохраняется, когда это возможно.
.It Cm o
Сохраняет ID пользователя и ID группы.
.It Cm p
.Sq Preserve
биты файлового режима.
Это предназначено для использования
.Em пользователь
с обычными привилегиями, который хочет сохранить все аспекты файла,
кроме права собственности.
Время загрузки файла сохраняется по умолчанию, но предлагаются два других флага, чтобы
отключить это и вместо этого использовать время извлечения.
.El
.Pp
В предыдущем списке
.Sq preserve
указывает, что сохраненный в архиве атрибут присваивается 
извлеченному файлу, в зависимости от разрешений вызывающего
процесса.
В противном случае атрибут извлеченного файла определяется как
часть стандартного действия по созданию файла
Если ни смвол спецификации
.Cm e ,
ни символ спецификации
.Cm o ,
или ID пользователя и ID группы
по какой-либо причине не сохранены,
.Nm
не установит
.Dv S_ISUID
.Em ( setuid )
и
.Dv S_ISGID
.Em ( setgid )
биты файлового режима.
Если по какой-либо причине не удастся сохранить какой-либо из этих элементов,
.Nm
отправит диагностическое сообщение в
.Dv standard error .
Несоблюдение этого требования повлияет на конечный статус завершения,
но не приведет к удалению извлеченного файла.
Если характеристические буквы файла в любом из параметров аргумент-строки
дублируются или конфликтуют друг с другом, приоритет будет иметь та, которая указана 
последней.
Например, если указан параметр
.Dl Fl p Ar eme ,
время изменения файла по-прежнему сохраняется.
.Pp
Файловые флаги, установленные
.Xr chflags 1
Не понимаются
.Nm ,
однако
.Xr tar 1
и
.Xr dump 8
сохранят их.
.It Fl s Ar строка_замены
Изменяет имена элементов файла или архива, указанные операндами
.Ar шаблон
или
.Ar файл
в соответствии с выражением подстановки
.Ar строка_замены ,
используя синтаксис регулярных выражений
.Xr ed 1
утииты.
Формат этих регулярных выражений следующий:
.Dl /old/new/[gp]
Как и в
.Xr ed 1 ,
.Cm old
является базовым регулярным выражением, а
.Cm new
может содержать амперсанд (&), \\n (где n - цифра) обратных ссылок
или совпадающих подвыражений.
Строка
.Cm old
может также содержать
.Dv <newline>
символы.
Любой ненулевой символ может быть использован в качестве разделителя (здесь показан/).
Несколько выраженй
.Fl s
может быть указано.
Выражения применяются в том порядке, в котором они указаны в
командной строке, завершаясь при первой успешной замене.
Необязательный завершающий символ
.Cm g
продолжает применять выражение подстановки к подстроке имени пути,
которая начинается с первого символа, следующего за концом 
последней успешной подстановки.
Первая неудачная замена останавливает работу
.Cm g
опции.
Необязательный завершающий символ
.Cm p
заставляет конечный результат успешной замены в
.Dv standard error
в следующем формате:
.Dl <original pathname> >> <new pathname>
Имена элементов файла или архива, которые заменяют пустую строку,
не выбираются и будут пропущены.
.It Fl t
Сбрасывает время доступа к любому файлу или каталогу, прочитанному или доступному с помощью
.Nm ,
так, чтобы оно было таким же, каким оно было до чтения или доступа с помощью
.Nm .
.It Fl u
Инорирует файлы, которые старше (имеет более позднее временя модификации файла)
чем уже существующий файл или член архива с тем же именем.
В ходе
.Em read 
будет извлечен элемент архива с тем же именем, что и у файла в файловой системе,
если элемент архива новее, чем файл.
В ходе
.Em write 
элемент файловой системы с тем же именем, что и элемент архива, будет
записан в архив, если он  новее, чем элемент архива.
В ходе
.Em copy ,
файл в целевой иерархии заменяется файлом из исходной
иерархии или ссылкой на файл в исходной иерархии, если файл в
исходной иерархии новее.
.It Fl v
В ходе операции
.Em list
создается подробное оглавление, используя формат утилиты
.Xr ls 1
с
.Fl l
опцией.
Для имен путей, представляющих собой жесткую ссылку на предыдущий элемент архива,
выходные данные имеют следующий формат:
.Dl <ls -l listing> == <link name>
Для имен путей, представляющих собой символьную ссылку, выходные данные имеют следующий формат:
.Dl <ls -l listing> => <link name>
Где <ls -l listing> - это формат вывода, указанный в утилите
.Xr ls 1
при использовании 
.Fl l 
опции.
В противном случае для всех других режимов работы
.Em ( read , write ,
и
.Em copy ) ,
имена путей записываются и преобразуются в
.Dv standard error
без завершения
.Dv <newline>
как только начнется обработка этого файла или
элемента архива.
Завершающий
.Dv <newline> 
не буферизуется и записывается только после того, как файл был cчитан или записан на диск.
.It Fl x Ar формат
Указывает формат выходного архива, при этом по умолчанию используется формат
.Ar ustar .
Утилита
.Nm
в настоящее время поддерживает следующие форматы:
.Bl -tag -width "sv4cpio"
.It Ar cpio
Расширенный формат обмена cpio, указанный d
.St -p1003.2
стандарте.
Размер блока по умолчанию для этого формата равен 5120 байтам.
Информация об индексном дескрипторе и устройстве файла (используемая для обнаружения жёстких ссылок файла
для этого формата), которая может быть усечена этим форматом, обнаруживается
.Nm
и восстанавливается.
.It Ar bcpio
Старый двоичный формат cpio.
Размер блока по умолчанию для этого формата равен 5120 байтам.
Этот формат не очень переносим и не должен использоваться, когда другие форматы 
доступны.
Информация об индексном дескрипторе и устройстве файла (используемая для обнаружения жёстких ссылок файла
для этого формата), которая может быть усечена этим форматом, обнаруживается
.Nm
и восстанавливается
.It Ar sv4cpio
Релиз 4 cpio System V.
Размер блока по умолчанию для этого формата равен 5120 байтам.
Информация об индексном дескрипторе и устройстве файла (используемая для обнаружения жёстких ссылок файла
для этого формата), которая может быть усечена этим форматом, обнаруживается
.Nm
и восстанавливается.
.It Ar sv4crc
Релиз 4 cpio System V с контрольными суммами файлов CRC..
Размер блока по умолчанию для этого формата равен 5120 байтам.
Информация об индексном дескрипторе и устройстве файла (используемая для обнаружения жёстких ссылок файла
для этого формата), которая может быть усечена этим форматом, обнаруживается
.Nm
и восстанавливается.
.It Ar tar
Старый формат tar в
.Bx ,
как он был найден в 
.Bx 4.3 .
Размер блока по умолчанию для этого формата равен 10240 байтам.
Длина имен путей, сохраняемых в этом формате, должна составлять не более 100 символов.
Только
.Em обычный
файлы,
.Em жесткие ссылки , мягкие ссылки ,
и
.Em директории
будут заархивированы (другие типы файловых систем не поддерживаются).
Для обеспечения обратной совместимости с еще более старыми форматами tar, опция
.Fl o
быть использована при создании архива, чтобы исключить хранение директорий.
Этот параметр принимает вид:
.Dl Fl o Cm write_opt=nodir
.It Ar ustar
Расширенный формат обмена tar, указанный в
.St -p1003.2
стандарте.
Размер блока по умолчанию для этого формата равен 10240 байтам.
Длина имен путей, сохраняемых в этом формате, должна составлять не более 255 символов.
Часть директории может содержать не более 155 символов, а каждый компонент пути
должен содержать не более 100 символов.
.El
.Pp
Утилита
.Nm
обнаружит и сообщит о каждом файле, который он не может сохранить или извлечь
из-за каких-либо определенных ограничений формата архива.
Отдельные форматы архивов могут накладывать дополнительные ограничения на использование.
Типичные ограничения формата архива включают (но не ограничиваются ими):
длину пути к файлу, размер файла, длину пути к ссылке и тип файла.
.It Fl z
Использует
.Xr gzip 1
для сжатия (распаковки) архива во время записи (чтения).
Несовместим с
.Fl a .
.It Fl B Ar байты
Ограничивает количество байт, записываемых на один архивный том, значением
.Ar байты .
Лимит
.Ar байты
может заканчиваться на 
.Li m ,
.Li k ,
или
.Li b
чтобы указать умножение на 1048576 (1M), 1024 (1K) или 512 соответственно.
Пара лимитов
.Ar байты
могут быть разделена
.Li x
для обозначения продукта.
.Pp
Обратите внимание, что указанный размер относится к самому образу pax без сжатия.
Если опция
.Fl z
также используется, результирующий файл может содержать меньше
.Ar байты ,
в зависимости от степени сжатия содержимого архива.
Смотрите
.Xr zip 1 Pq Pa ports/archivers/zip
если требуются сжатые тома предсказуемого размера.
.Pp
.Em предупреждение :
Используйте этот параметр только при записи архива на устройство, которое поддерживает
условие окончания чтения файла, основанное на последнем (или наибольшем) смещении записи
(например, обычный файл или ленточный накопитель).
Не рекомендуется использовать эту опцию с гибкими или жесткими дисками.
.It Fl D
Этот параметр аналогичен параметру
.Fl u , 
за исключением того, что вместо времени изменения файла проверяется 
время изменения индекса файла.
Время изменения индексного дескриптора файла может использоваться для выбора файлов, информация индексного дескриптора которых 
(например, uid, gid и т.д.) новее, чем копия файла в целевой
.Ar директория .
.It Fl E Ar лимит
Ограничивает количество последовательных ошибок чтения при попытке прочитать поврежденный
архив до
.Ar лимит .
При положительном результате
.Ar лимит ,
.Nm
попытается восстановить файл после ошибки чтения из архива и
продолжит обработку, начиная со следующего файла, сохраненного в архиве.
Значение аргумента
.Ar лимит
равное 0 заставляет
.Nm
остановить работу после обнаружения первой ошибки чтения в архивном томе.
Значение аргумента
.Ar лимит
равное
.Li NONE
заставляет
.Nm
всегда пытаться восстановиться после ошибок чтения.
Значение по умолчанию
.Ar лимит
это небольшое положительное число повторных попыток.
.Pp
.Em Предупреждение :
Использование этой опции с параметром
.Li NONE
следует использовать с особой осторожностью, так как
.Nm
может застрять в бесконечном цикле работы с очень сильно поврежденным архивом.
.It Fl G Ar группа
Выберает файл, основываясь на его имени
.Ar группа
или, когда начинается с
.Cm # ,
на основе числового идентификатора gid.
Символ '\\' может быть использован для экранирования файла
.Cm # .
Можно указать несколько опций
.Fl G ,
и проверка прекращается при первом совпадении.
.It Fl H
Следует только символическим ссылкам командной строки при выполнении физического обхода 
файловой системы.
.It Fl L
Переходит по всем символическим ссылкам, чтобы выполнить логический обход файловой системы.
.It Fl O
Делает так, чтобы архив состоял из одного тома.
Если том заканчивается преждевременно,
.Nm
не будет запрашиваться новый том.
Эта опция может быть полезна для
автоматизированных задач, в которых восстановление ошибок не может быть выполнено человеком.
.It Fl P
Не переходит по символьным ссылкам, выполняет физический обход файловой системы.
Это режим по умолчанию.
.It Fl T Ar [от_даты][,до_даты][/[c][m]]
Разрешить выбор файлов на основе времени модификации файла или изменения индексного дескриптора,
которое попадает в указанный временной диапазон от
.Ar от_даты
до
.Ar до_даты
(даты включительно).
Если указан только 
.Ar от_даты
будут выбраны все файлы, время модификации или изменение индексного дескриптора
которых равно или меньше указанного.
Если указан только
.Ar до_даты
будут выбраны все файлы, время модификации или изменение индексного дескриптора
которых равно или больше указанного.
Когда значение
.Ar от_даты
равно значению
.Ar до_даты ,
будут выбраны только файлы, время модификации или изменения индексного кода которых совпадает именно
с этим временем.
.Pp
Когда
.Nm
находится в режиме
.Em write
или
.Em copy
необязательное завершающее поле
.Ar [c][m]
может использоваться для определения того, какое время файла (изменение индекса, модификация файла или
и то, и другое) используется при сравнении.
Если не указано ни то, ни другое, то по умолчанию используется только время изменения файла.
Параметр
.Ar m
определяет сравнение времени модификации файла (время, когда
файл был последний раз записан).
The
.Ar c
задаёт сравнение времени изменения индексного дескриптора (время, когда индексный дескриптор файла
был изменён в последний раз; например, при смене владельца, группы, прав доступа и т.д.).
 Если оба параметра -
.Ar c
и
.Ar m
указаны,  то сравниваются время модификации и время изменения индексного
кода.
Сравнение времени изменения индексного дескриптора полезно длявыбора файлов,
атрибуты которых были недавно изменены, или для выбора файлов, которые были недавно
созданы и у которых время модификации было сброшено на более раннее (как это
происходит, когда файл извлекается из архива и время модификации 
сохраняется).
Сравнение времени с использованием времени обоих файлов полезно, когда
.Nm
используется для создания инкрементного архива, основанного на времени (будут заархивированы только те файлы, которые были
изменены в течение указанного периода времени).
.Pp
Временной диапазон состоит из шести различных полей, и каждое поле должно содержать две
цифры.
Формат выглядит следующим образом:
.Pp
.Dl [[[[[cc]yy]mm]dd]HH]MM[.SS]
.Pp
Где
.Ar cc
это первые две цифры года (столетия),
.Ar yy
это две последние цифры года,
первый
.Ar mm
является месяцем (от 01 до 12),
.Ar dd
является днем месяца (от 01 до 31),
.Ar HH
является часом дня (от 00 до 23),
.Ar MM
является минутой (от 00 до 59),
и
.Ar SS
является секундами (от 00 до 59).
Поле минут
.Ar MM
является обязательным, в то время как остальные поля являются необязательными и должны быть добавлены в
следующем порядке:
.Ar HH , dd , mm , yy , cc .
Поле
.Cm ss
может быть добавлено независимо от других полей.
Временные диапазоны указаны относительно текущего времени, поэтому
.Dl Fl T Ar 1234/cm
выберет все файлы с временем модификации или изменения индексного дескриптора,
соответствующим 12:34 дня сегодняшнего дня или позже.
Можно указать несколько диапазонов времени с помощью
.Fl T
и проверка прекращается при первом совпадении.
.It Fl U Ar пользователь
Выберите файл, основываясь на его имени
.Ar пользователь , 
или если он начинается с
.Cm # ,
числового uid.
Символ '\\' может быть использован для экранирования файла
.Cm # .
Можно указать несколько диапазонов времени с помощью
.Fl U
и проверка прекращается при первом совпадении.
.It Fl X
При перемещении по файловой иерархии, указанной в имени пути,
не заходите в каталоги, которые имеют другой ID устройства.
Смотрите поле
.Li st_dev
как описано в
.Xr stat 2
для получения дополнительной информации об ID устройств.
.It Fl Y
Эта опция аналогична
.Fl D
за исключением того, что время изменения индексного индекса проверяется с помощью
пути, созданного после завершения всех изменений имени файла.
.It Fl Z
Эта опция аналогична
.Fl u
за исключением того, что время изменения проверяется с помощью
пути, созданного после завершения всех изменений имени файла.
.El
.Pp
Параметры, которые работают с именами файлов или элементов архива
.Fl ( c ,
.Fl i ,
.Fl n ,
.Fl s ,
.Fl u ,
.Fl v ,
.Fl D ,
.Fl G ,
.Fl T ,
.Fl U ,
.Fl Y ,
и
.Fl Z )
взаимодействуют следующим образом.
.Pp
При извлечении файлов во время операции
.Em read
членами архива являются
.Sq selected ,
основанный только на заданных пользователем шаблонных операндах, измененных
.Fl c ,
.Fl n ,
.Fl u ,
.Fl D ,
.Fl G ,
.Fl T ,
.Fl U
опциями.
Тогда любые опции
.Fl s
и
.Fl i
изменят имена этих выбранных файлов в указанном порядке.
Затем, опции
.Fl Y
и
.Fl Z
будут применены в зависимости от окончательного пути к файлу.
Наконец, опция
.Fl v
опция запишет имена, полученные в результате этих изменений.
.Pp
При архивировании файлов во время операции
.Em write ,
или копирование файлов во время операции
.Em copy
членами архива являются
.Sq selected ,
основанные только на указанных пользователем путевых именах, измененных
.Fl n ,
.Fl u ,
.Fl D ,
.Fl G ,
.Fl T ,
и
.Fl U
опциями (опция
.Fl D
применяется только во время операции копирования).
Затем любые опции
.Fl s
и
.Fl i
изменят имена этих выбранных файлов в указанном порядке.
Затем во время операции
.Em copy
опция
.Fl Y
и опция
.Fl Z
будет применена на основе конечного пути.
Наконец, опция
.Fl v
запишет имена, полученные в результате этих изменений.
.Pp
Когда одна или обе опции
.Fl u
и
.Fl D
указываются вместе с опцией
.Fl n
файл не считается выбранным, если он не является более новым,
чем файл, с которым он сравнивается.
.Sh СТАТУС ЗАВЕРШЕНИЯ
Утилита
.Nm
завершится с одним из следующих значений:
.Bl -tag -width 2n
.It 0
Все файлы были успешно обработаны.
.It 1
Произошла ошибка.
.El
.Sh Примеры
Команда:
.Dl "pax -w -f /dev/sa0 ."
копирует содержимое текущего каталога на устройство
.Pa /dev/sa0 .
.Pp
Команда:
.Dl pax -v -f filename
содержит подробное оглавление архива, хранящегося в
.Pa имя_файла .
.Pp
Следующие команды:
.Dl mkdir /tmp/to
.Dl cd /tmp/from
.Dl pax -rw .\ /tmp/to
скопирует всю иерархию директории
.Pa /tmp/from
в
.Pa /tmp/to .
.Pp
Команда:
.Dl pax -r -s ',^//*usr//*,,' -f a.pax
считывает архив
.Pa a.pax ,
при этом все файлы с корнем в ``/usr'' будут помещены в архив, извлеченный относительно
текущей директории.
.Pp
Команда:
.Dl pax -rw -i .\ dest_dir
может использоваться для интерактивного выбора файлов для копирования из текущей
директории в
.Pa dest_dir .
.Pp
Команда:
.Dl pax -r -pe -U root -G bin -f a.pax
извлекает все файлы из архива
.Pa a.pax
которые принадлежат
.Em root
с группой
.Em bin
и сохранит все права доступа к файлам.
.Pp
Команда :
.Dl pax -r -w -v -Y -Z home /backup
обновит (и выведет список) только те файлы в целевой директории
.Pa /backup
которые старше (с более ранним временем изменения индексного дескриптора или временем модификации файла), чем
файлы с тем же именем, найденные в исходном дереве файлов
.Pa home .
.Sh ДИАГНОСТИКА
Всякий раз, когда
.Nm
не может создать файл или ссылку при чтении архива, или не может
найти файл при записи архива, или не может сохранить ID пользователя,
ID группы или режим файла, когда указана опция
.Fl p
диагностическое сообщение записывается в
.Dv standard error
и будет возвращён ненулевой статус выхода, но обработка будет продолжена.
В случае, если pax не может создать ссылку на файл,
.Nm
не создаст вторую копию файла..
.Pp
Если извлечение файла из архива преждевременно завершается из-за
сигнала или ошибки, воможно 
.Nm
который был нужен пользователю, был извлечен лишь частично.
Кроме того, файловые режимы извлеченных файлов и директорий
могут содержать неверные разряды файлов, а время изменения и доступа может быть
неправильным.
.Pp
Если создание архива преждевременно завершается из-за сигнала или ошибки,
.Nm
возможно, архив был создан только частично, что может нарушать конкретную
спецификацию формата архива.
.Pp
Если при выполнении
.Em copy ,
.Nm
обнаруживает, что файл собирается перезаписать сам себя, файл не копируется,
диагностическое сообщение записывается в
.Dv standard error
и когда
.Nm
он завершит работу с ненулевым статусом завершения.
.Sh СМОТРИТЕ ТАКЖЕ
.Xr cpio 1 ,
.Xr tar 1
.Sh СТАНДАРТЫ
Утилита
.Nm
является дополнением к
.St -p1003.2
стандарту.
Опции
.Fl z ,
.Fl B ,
.Fl D ,
.Fl E ,
.Fl G ,
.Fl H ,
.Fl L ,
.Fl O ,
.Fl P ,
.Fl T ,
.Fl U ,
.Fl Y ,
.Fl Z ,
форматы архивов
.Ar bcpio ,
.Ar sv4cpio ,
.Ar sv4crc ,
.Ar tar ,
и некорректная обработка архивов во время операций
.Ar list
and
.Ar read
являются расширениями к
.Tn POSIX
стандарту.
.Sh ИСТОРИЯ
Утилита
.Nm
появилась в
.Bx 4.4 .
.Sh АВТОРЫ
.An Кит Мюллер
из Калифорнийского университета, Сан-Диего
.Sh БАГИ
Утилита
.Nm
не распознает многобайтовые символы.
.Pp
Файловые флаги, установленные с помощью
.Xr chflags 1
не сохраняются
.Nm .
В разделе "БАГИ"
.Xr chflags 1
содержит список утилит, которые не знают о флагах.
