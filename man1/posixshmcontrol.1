.\" Copyright (c) 2019 FreeBSD Foundation, Inc.
.\"
.\" Эта документация была написана 
.\" Константином Белоусовым <kib@FreeBSD.org> при спонсорской поддержке
.\" FreeBSD Foundation.
.\"
.\" Распространение и использование в исходном коде и двоичной форме, с использованием или без использования
.\" модификаций, если следующие условия
.\" соблюдаются:
.\" 1. При распространении исходного кода должно сохраняться вышеуказанное уведомление
.\"    об авторских правах, этот список условий и следующий дисклеймер.
.\" 2. При распространиении в двоичной форме должно воспроизводиться уведомление об авторских правах,
.\"    этот список условий и следующий ниже отказ от ответственности в
.\"    документации и/или других материалах, поставляемых с дистрибутивом.
.\"
.\" ДАННОЕ ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ ПРЕДОСТАВЛЯЕТСЯ ПРАВООБЛАДАТЕЛЯМИ И СОАВТОРАМИ ``КАК ЕСТЬ'', И 
.\" МЫ ОТКАЗЫВАЕМСЯ ОТ ЛЮБЫХ ПОДРАЗУМЕВАЕМЫХ ОБЯЗАТЕЛЬСТВ, ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ, 
.\" ПОДРАЗУМЕВАЕМЫЕ ГАРАНТИИ ТОВАРНОЙ ПРИГОДНОСТИ И НЕПРИГОДНОСТИ ДЛЯ ОПРЕДЕЛЕННОЙ
.\" ЦЕЛИ. НИ В КОЕМ СЛУЧАЕ ПРАВООБЛАДАТЕЛИ ИЛИ СОВАТОРЫ НЕ НЕСУТ ОТВЕТСТВЕННОСТИ
.\" ЗА ЛЮБЫЕ ПРЯМЫЕ, КОСВЕННЫЕ, СЛУЧАЙНЫЕ, ОСОБЫЕ, ПОКАЗАТЕЛЬНЫЕ ИЛИ ЛОГИЧЕСКИ ВЫТЕКАЮЩИЕ
.\" УБЫТКИ (ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ ИМИ, ПРИОБРЕТЕНИЕ ЗАМЕНЯЮЩИХ ТОВАРОВ ИЛИ УСЛУГ;
.\" ПОТЕРЮ ВОЗМОЖНОСТИ ИСПОЛЬЗОВАНИЯ, ДАННЫХ ИЛИ ПРИБЫЛИ; ИЛИ ПРЕКРАЩЕНИЕ ДЕЯТЕЛЬНОСТИ)
.\" НЕЗАВИСИМО ОТ ПРИЧИНЕННОГО УЩЕРБА И НА ОСНОВАНИИ ЛЮБОЙ ТЕОРИИ ОТВЕТСТВЕННОСТИ, БУДЬ ТО В РАМКАХ КОНТРАКТА, 
.\" ПРЯМОЙ ОТВЕТСТВЕННОСТИ ИЛИ ДЕЛИКТА (ВКЛЮЧАЯ ХАЛАТНОСТЬ ИЛИ ИНОЕ), ВОЗНИКШЕГО КАКИМ-ЛИБО ОБРАЗОМ
.\" В РЕЗУЛЬТАТЕ ИСПОЛЬЗОВАНИЯ ДАННОГО ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ, ДАЖЕ ЕСЛИ ВЫ БЫЛИ ОСВЕДОМЛЕНЫ О ВОЗМОЖНОСТИ
.\" ТАКОГО УЩЕРБА.
.\"
.Dd 25 мая, 2023 год
.Dt POSIXSHMCONTROL 1
.Os
.Sh НАЗВАНИЕ
.Nm posixshmcontrol
.Nd Control POSIX shared memory segments
.Sh СИНТАКСИС
.Nm
.Ar create
.Op Fl l Ar размер_страницы
.Op Fl m Ar режим
.Op Pa путь \&...
.Nm
.Ar rm
.Op Pa путь \&...
.Nm
.Ar ls
.Op Fl h
.Op Fl n
.Op Fl j Ar джейл
.Nm
.Ar dump
.Op Pa путь \&...
.Nm
.Ar stat
.Op Fl h
.Op Fl n
.Op Pa путь \&...
.Nm
.Ar truncate
.Op Fl s Ar длина
.Op Pa путь \&...
.Sh ОПИСАНИЕ
Команда
.Nm
управляет именованными сегментами разделяемой памяти POSIX.
Она позволяет осматривать существующие сегменты, выгружать их метаданные или содержимое,
и отвязывать их.
.Pp
Отвязывание удаляет имя из системы и, когда последний процесс
отображает сегмент и закрывает файловый дескриптор, указывающий на сегмент,
освобождает подлежащую память.
.Pp
Количество жёстких ссылок, отображаемых подкомандой
.Ic stat,
равно количеству ссылок на базовый объект виртуальной 
памяти.
Почти всегда это равно количеству отображений +1, за исключением
переходных ссылок.
.Pp
Предоставляются следующие подкоманды:
.Bl -tag -width truncate
.It Ic create
Создать сегменты с указанными путями, если они ещё не существуют.
.Pp
Необязательный аргумент
.Ar размер_страницы
определяет размер виртуальных страниц, используемых для отображения
объекта с помощью
.Xr mmap 2 .
По умолчанию используется размер системной страницы, но на некоторых платформах
можно указать больший размер страницы.
Размер объекта, поддерживаемого большими страницами, должен быть кратен
указанному размеру страницы.
Переменная sysctl
.Va hw.pagesizes
перечисляет доступные размеры страниц.
.Pp
Необязательный числовой аргумент
.Ar mode
определяет начальный режим доступа.
.It Ic rm
Отвязывает указанные пути.
.It Ic ls
Список всех связанных именованных сегментов разделяемой памяти, видимых вызывающему.
Для каждого сегмента отображаются владелец пользователь и группа, размер и путь.
Опция
.Fl j
ограничивает вывод сегментами в указанной
.Ar jail
имени или идентификаторе.
.It Ic dump
Выводит значения байтов из сегмента в стандартный вывод.
.It Ic stat
Печатает метаданные для указанного пути в формате, аналогичном утилите
.Xr stat 1 .
.It Ic truncate
Изменяет длину сегментов.
Аргумент к опции
.Fl s
указывает новую длину.
Можно использовать удобные для восприятия суффиксы 'k', 'm', 'g', 
смотрите
.Xr expand_number 3 .
Если опция не указана, предполагаемая длина равна нулю.
.El
.Pp
Для некоторых команд могут быть предоставлены следующие опции:
.Bl -tag -width XXX
.It Fl h
Если указано, запрашивает отображение размера в удобочитаемом формате, смотрите
.Xr humanize_number 3 .
.It Fl n
Предотвращает перевод владельца и группы в символические имена
с использованием служб переключения имен, вместо этого печатаются сырые числовые значения.
.El
.Sh СТАТУС ЗАВЕРШЕНИЯ
.Ex -std
.Sh ПРИМЕРЫ
.Bl -bullet
.It
Чтобы показать содержимое сегмента разделяемой памяти с путем
.Pa /1 ,
используйте команду
.Dl "posixshmcontrol dump /1 | hexdump -C"
.It
Чтобы создать сегмент с путём
.Pa /2
и затем увеличить его до 1M, используйте последовательность команд
.Dl "posixshmcontrol create /2"
.Dl "posixshmcontrol truncate -s 1m /2"
.El
.Sh СМОТРИТЕ ТАКЖЕ
.Xr hexdump 1 ,
.Xr stat 1 ,
.Xr ftruncate 2 ,
.Xr mmap 2 ,
.Xr read 2 ,
.Xr shm_open 2 ,
.Xr shm_unlink 2 ,
.Xr stat 2 ,
.Xr expand_number 3 ,
.Xr humanize_number 3 ,
.Xr shm_create_largepage 3 ,
.Xr sysctl 3
.Sh ИСТОРИЯ
Команда
.Nm
появилась в
.Fx 12.1 .
.Sh АВТОРЫ
Команда
.Nm
команда и эта страница мануала были написаны
.An Konstantin Belousov Aq Mt kib@freebsd.org
при спонсорской поддержке
.Fx
Организации.
