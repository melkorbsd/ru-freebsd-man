.\" Copyright (c) 2013 Hudson River Trading LLC
.\" Написано: Джон Х. Болдуин <jhb@FreeBSD.org>
.\" Все права защищены.
.\"
.\" Распространение и использование в исходном коде и двоичной форме, с использованием или без использования
.\" модификаций, если следующие условия
.\" соблюдаются:
.\" 1. При распространении исходного кода должно сохраняться вышеуказанное уведомление
.\"    об авторских правах, этот список условий и следующий дисклеймер.
.\" 2. При распространиении в двоичной форме должно воспроизводиться уведомление об авторских правах,
.\"    этот список условий и следующий ниже отказ от ответственности в
.\"    документации и/или других материалах, поставляемых с дистрибутивом.
.\"
.\" ДАННОЕ ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ ПРЕДОСТАВЛЯЕТСЯ ПРАВООБЛАДАТЕЛЯМИ И СОАВТОРАМИ ``КАК ЕСТЬ'', И 
.\" МЫ ОТКАЗЫВАЕМСЯ ОТ ЛЮБЫХ ПОДРАЗУМЕВАЕМЫХ ОБЯЗАТЕЛЬСТВ, ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ, 
.\" ПОДРАЗУМЕВАЕМЫЕ ГАРАНТИИ ТОВАРНОЙ ПРИГОДНОСТИ И НЕПРИГОДНОСТИ ДЛЯ ОПРЕДЕЛЕННОЙ
.\" ЦЕЛИ. НИ В КОЕМ СЛУЧАЕ ПРАВООБЛАДАТЕЛИ ИЛИ СОВАТОРЫ НЕ НЕСУТ ОТВЕТСТВЕННОСТИ
.\" ЗА ЛЮБЫЕ ПРЯМЫЕ, КОСВЕННЫЕ, СЛУЧАЙНЫЕ, ОСОБЫЕ, ПОКАЗАТЕЛЬНЫЕ ИЛИ ЛОГИЧЕСКИ ВЫТЕКАЮЩИЕ
.\" УБЫТКИ (ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ ИМИ, ПРИОБРЕТЕНИЕ ЗАМЕНЯЮЩИХ ТОВАРОВ ИЛИ УСЛУГ;
.\" ПОТЕРЮ ВОЗМОЖНОСТИ ИСПОЛЬЗОВАНИЯ, ДАННЫХ ИЛИ ПРИБЫЛИ; ИЛИ ПРЕКРАЩЕНИЕ ДЕЯТЕЛЬНОСТИ)
.\" НЕЗАВИСИМО ОТ ПРИЧИНЕННОГО УЩЕРБА И НА ОСНОВАНИИ ЛЮБОЙ ТЕОРИИ ОТВЕТСТВЕННОСТИ, БУДЬ ТО В РАМКАХ КОНТРАКТА, 
.\" ПРЯМОЙ ОТВЕТСТВЕННОСТИ ИЛИ ДЕЛИКТА (ВКЛЮЧАЯ ХАЛАТНОСТЬ ИЛИ ИНОЕ), ВОЗНИКШЕГО КАКИМ-ЛИБО ОБРАЗОМ
.\" В РЕЗУЛЬТАТЕ ИСПОЛЬЗОВАНИЯ ДАННОГО ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ, ДАЖЕ ЕСЛИ ВЫ БЫЛИ ОСВЕДОМЛЕНЫ О ВОЗМОЖНОСТИ
.\" ТАКОГО УЩЕРБА.
.\"
.Dd 12 июля, 2022 год
.Dt PROTECT 1
.Os
.Sh НАЗВАНИЕ
.Nm protect
.Nd "protect processes from being killed when swap space is exhausted"
.Sh СИНТАКСИС
.Nm
.Op Fl i
.Ar команда
.Nm
.Op Fl cdi
.Fl g Ar группа_процессов
.Nm
.Op Fl cdi
.Fl p Ar идентификатор_процесса
.Sh ОПИСАНИЕ
Команда
.Nm
используется для маркировки процессов как защищённых.
Ядро системы не завершает защищённые процессы, даже если закончилось место в подкачке. 
Обратите внимание, что защищённое состояние по умолчанию не наследуется дочерними процессами.
.Pp
Возможны следующие варианты:
.Bl -tag -width команда
.It Fl c
Снимает защиту с указаннных процессов.
.It Fl d
Применяет операцию ко всем текущим дочерним процессам указанных процессов.
.It Fl i
Применяет операцию ко всем будущим дочерним процессам указанных процессов.
.It Fl g Ar группа_процессов
Применить операцию ко всем процессам в указанной группе процессов.
.It Fl p Ar идентификатор_процесса
Применяет операцию к указанному процессу.
.It Ar команда
Выполняет
.Ar команда
как защищённый процесс.
.El
.Pp
Обратите внимание, что  только один из флагов
.Fl p
или
.Fl g
может быть указан при корректировке состояния существующих процессов
.Pp
Демоны могут быть защищены при запуске с использованием опции 
.Ao Ar name Ac Ns Va _oomprotect
из
.Xr rc.conf 5 .
.Sh СТАТУС ЗАВЕРШЕНИЯ
.Ex -std
.Sh ПРИМЕРЫ
Отметить сервер Xorg как защищённый:
.Pp
.Dl "pgrep Xorg | xargs protect -p"
.Pp
Защитить все сеансы ssh и их дочерние процессы:
.Pp
.Dl "pgrep sshd | xargs protect -dip"
.Pp
Снять защиту со всех текущих и будущих процессов:
.Pp
.Dl "protect -cdi -p 1"
.Pp
Использовать
.Xr ps 1
для проверки, был ли применён флаг защиты к процессу:
.Pp
.Dl "ps -O flags,flags2 -p 64430"
.Pp
.Dl " PID        F       F2 TT  STAT    TIME COMMAND"
.Dl "64430 10104002 00000001  5  S+   0:00.00 ./main"
.Dl "        ^P            ^PI"
.Pp
В приведённом выше примере
.Nm P
казывает на флаг защиты и
.Nm PI
указывает на флаг наследования.
Процесс защищён, если бит
.Nm P
установлен в 1.
Все дочерние процессы этого процесса также будут защищены, если бит 
.Nm PI
установлен в 1.
.Sh ДИАГНОСТИКА
.Bl -diag
.It "protect: procctl: Operation not permitted"
Команда
.Nm
не имеет необходимых разрешений для защиты выбранных процессов.
Существует множество причин, по которым это может быть, например:
.Bl -dash
.It
.Nm
не выполняется от имени root.
.It
.Nm
выполняется внутри
.Xr jail 8 ,
который в настоящее время не поддерживается.
.El
.El
.Sh СМОТРИТЕ ТАКЖЕ
.Xr ps 1 ,
.Xr procctl 2 ,
.Xr rc.conf 5
.Sh БАГИ
Если вы защитите процесс, который выделяет всю память, система 
заблокируется.
