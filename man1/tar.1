.\" Copyright (c) 2003-2007 Tim Kientzle
.\" Copyright (c) 2017 Martin Matuska
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\" $FreeBSD$
.\"
.Dd 1 декабря, 2022
.Dt TAR 1
.Os
.Sh ИМЯ
.Nm tar
.Nd управление архивами ленты
.Sh СИНТАКСИС
.Nm
.Op Аргументы-флаги Ao args Ac
.Op Ao Аргумент-файл Ac | Ao Ar Шаблон Ac ...
.Nm
.Brq Fl c
.Op параметры
.Op файлы | директории
.Nm
.Brq Fl r | Fl u
.Fl f Архивный-файл
.Op параметры
.Op файлы | директории
.Nm
.Brq Fl t | Fl x
.Op параметры
.Op шаблоны
.Sh ОПИСАНИЕ
.Nm
создает и управляет потоковыми архивными файлами.
Эта реализация может извлекать из tar, pax, cpio, zip, jar, ar, xar,
rpm, 7-zip, И ISO 9660 cdrom образов и создавать tar, pax, cpio, ar, zip,
7-zip, и shar архивы.
.Pp
Первая форма синтаксиса показывает
.Dq bundled
параметр пакетного слова.
Это использование предоставлено для совместимости с историческими реализациями.
См. раздел СОВМЕСТИМОСТЬ ниже для деталей.
.Pp
Другие формы синтаксиса показывают предпочтительное использование.
Первый параметр для
.Nm
это индикатор режима из следующего списка:
.Bl -tag -compact -width indent
.It Fl c
Создать новый архив, содержащий указанные элементы.
Длинная форма параметра
.Fl Fl create .
.It Fl r
Как
.Fl c ,
но новые записи добавляются в архив.
Обратите внимание, что это работает только с негруппированными архивами, хранящимися в обычных файлах.
Параметр
.Fl f
обязательна.
Длинная форма параметра
.Fl Fl append .
.It Fl t
Вывести содержимое архива в stdout.
Длинная форма параметра 
.Fl Fl list .
.It Fl u
Как
.Fl r ,
но новые записи добавляются только если они имеют дату изменения,
более позднюю, чем соответствующая запись в архиве.
Обратите внимание, что это работает только с негруппированными архивами, хранящимися в обычных файлах.
Параметр
.Fl f
обязательна.
Длинная форма
.Fl Fl update .
.It Fl x
Извлечь на диск из архива.
Если файл с тем же именем появляется более одного раза в архиве,
каждая копия будет извлечена, при этом более поздние копии перезаписывают (заменяют)
ранние копии.
Длинная форма параметра
.Fl Fl extract .
.El
.Pp
В
.Fl c ,
.Fl r ,
или
.Fl u
режиме, каждый указанный файл или директория добавляется в 
архив в порядке, указанном в командной строке.
По умолчанию также архивируется содержимое каждой директории.
.Pp
В режиме извлечения или списка командная строка 
целиком считывается и разбирается перед открытием архива.
Пути или шаблоны в командной строке указывают,
какие элементы в архиве должны быть обработаны.
Шаблоны - это шаблоны глобирования стиля оболочки,
как описано в
.Xr tcsh 1 .
.Sh ПАРАМЕТРЫ
За исключением явно указанных иначе, параметры применимы 
во всех режимах работы.
.Bl -tag -width indent
.It Cm @ Ns Pa архив
(только режимы c и r )
Указанный архив открывается, и записи в нем будут 
добавлены к текущему архиву.
Простой пример,
.Dl Nm Fl c Fl f Pa - Pa новый файл Cm @ Ns Pa оригинальный.tar
записывает новый архив на стандартный вывод, содержащий файл
.Pa новый файл
и все записи из 
.Pa оригинальный.tar .
В отличие от этого,
.Dl Nm Fl c Fl f Pa - Pa новый файл Pa оригинальный.tar
создает новый архив только с двумя записями.
Аналогично,
.Dl Nm Fl czf Pa - Fl Fl формат Cm pax Cm @ Ns Pa -
читает архив из стандартного ввода (формат будет определен 
автоматически) и преобразует его в gzip-сжатый
pax-формата архив на stdout.
Таким образом,
.Nm
может использоваться для преобразования архивов из одного формата в другой.
.It Fl a , Fl Fl auto-compress
(только режим c)
Используйте суффикс архива для определения набора формата и 
сжатия.
Простой пример,
.Dl Nm Fl a Fl cf Pa archive.tgz source.c source.h
создает новый архив с ограниченным pax fформат и gzip сжатием,
.Dl Nm Fl a Fl cf Pa archive.tar.bz2.uu source.c source.h
создает новый архив с ограниченным pax форматом и bzip2 сжатием
и uuencode сжатие,
.Dl Nm Fl a Fl cf Pa archive.zip source.c source.h
создает новый архив в zip формате,
.Dl Nm Fl a Fl jcf Pa archive.tgz source.c source.h
игнорирует
.Dq -j
параметр, и создает новый архив с ограниченным pax форматом
и gzip сжатием,
.Dl Nm Fl a Fl jcf Pa archive.xxx source.c source.h
Если это неизвестный суффикс или отсутствует суффикс, создает новый архив с
ограниченным pax форматом и bzip2 сжатием.
.It Fl Fl acls
(только c, r, u, x режимы)
Архивирует или извлекает POSIX.1e или NFSv4 ACLs.
Это противоположно
.Fl Fl no-acls
и является поведением по умолчанию в c, r, и u режимах (за исключением Mac OS X) или при
.Nm
запуске в x режиме от root.
On Mac OS X эта опция преобразует расширенные ACLs в NFSv4 ACLs.
Для сохранения расширенных ACLs 
.Fl Fl mac-metadata
параметр предпочтителен.
.It Fl B , Fl Fl read-full-blocks
Игнорируется для совместимости с другими
.Xr tar 1
реализациями.
.It Fl b Ar blocksize , Fl Fl block-size Ar blocksize
Указывает размер блока, в записях по 512 байт, для ввода-вывода на магнитную ленту.
Как правило,этот аргумент необходим только при чтении с ленточных накопителей или записи
на них,и обычно даже в этом случае его нет,поскольку размер блока по умолчанию
составляет 20 записей (10240 байт).
.It Fl C Ar directory , Fl Fl cd Ar directory , Fl Fl directory Ar directory
В c и r режимах, меняет директорию перед добавлением 
следующих файлов.
В x режиме, меняет директории после открытия архива, 
но перед извлечением записей из архива.
.It Fl Fl chroot
(только режим x )
.Fn chroot
в текущий каталог после обработки любых
.Fl C
параметров и перед извлечением файлов.
.It Fl Fl clear-nochange-fflags
(только режим x)
перед удалением объектов файловой системы для их замены очищает платформенные специфические атрибуты
файла или флаги файла, которые могут предотвратить удаление.
.It Fl Fl exclude Ar pattern
Не обрабатывает файлы или каталоги, соответствующие 
указанному шаблону.
Обратите внимание, что исключения имеют приоритет над шаблонами или именами файлов,
указанными в командной строке.
.It Fl Fl exclude-vcs
Не обрабатывает файлы или каталоги, используемые внутренне 
системами контроля версий
.Sq Arch ,
.Sq Bazaar ,
.Sq CVS ,
.Sq Darcs ,
.Sq Mercurial ,
.Sq RCS ,
.Sq SCCS ,
.Sq SVN
и
.Sq git .
.It Fl Fl fflags
(только c, r, u, x режимы )
Архивирует или извлекает платформенные специфические атрибуты файла или флаги файла. 
Это противоположно 
.Fl Fl no-fflags
и является поведением по умолчанию в c, r, и u режимах, если
.Nm
запущен в x режиме от root.
.It Fl Fl format Ar format
(только c, r, u режимы)
Использует указанный формат для созданного архива.
Поддерживаемые форматы включают 
.Dq cpio ,
.Dq pax ,
.Dq shar ,
и
.Dq ustar .
Другие форматы также могут поддерживаться; см.
.Xr libarchive-formats 5
для получения дополнительной информации о текущих поддерживаемых форматах.
В r и u режимах, при расширении существующего архива указанный 
здесь формат должен быть совместим с форматом существующего архива на диске.
.It Fl f Ar file , Fl Fl file Ar file
Читает архив из указанного файла или записывает архив в указанный файл.
Имя файла может быть
.Pa -
для стандартного ввода или стандартного вывода. 
По умолчанию это зависит от системы;
на
.Fx ,
по умолчанию
.Pa /dev/sa0 ;
на Linux, по умолчанию
.Pa /dev/st0 .
.It Fl Fl gid Ar id
Использует предоставленный номер группы. 
При извлечении это переопределяет идентификатор группы в архиве; 
имя группы в архиве будет проигнорировано. 
При создании это переопределяет идентификатор группы, прочитанный с диска; 
Если
.Fl Fl gname
не указано gname, имя группы будет установлено для 
соответствия идентификатору группы.
.It Fl Fl gname Ar name
Использует предоставленное имя группы. 
При извлечении это переопределяет имя группы в архиве; 
если предоставленное имя группы не существует в системе,
идентификатор группы
(из архива или из
.Fl Fl gid
параметра)
будет использован.
При создании это задает имя группы, которое будет сохранено
в архиве; 
имя не будет проверено по базе данных системы групп.
.It Fl H
(только c и r режимы)
Символические ссылки, указанные в командной строке, будут разрешены; 
цель ссылки будет архивирована, а не сама ссылка.
.It Fl h
(только c и r режимы)
Синоним для
.Fl L .
.It Fl I
Синоним для
.Fl T .
.It Fl Fl help
Показать использование.
.It Fl Fl hfsCompression
(только x режим)
Mac OS X специфично (v10.6 или позднее). Сжимает извлеченные обычные файлы с HFS+
сжатием.
.It Fl Fl ignore-zeros
Псевдоним 
.Fl Fl options Cm read_concatenated_archives
для совместимости с GNU tar.
.It Fl Fl include Ar pattern
Обрабатывать только файлы или каталоги, которые соответствуют указанному шаблону.
Обратите внимание, что исключения, указанные с помощью
.Fl Fl exclude
имеют приоритет над включениями.
Если явные включения не указаны, по умолчанию обрабатываются все записи.
Параметр
.Fl Fl include
особенно полезна при фильтрации архивов.
Например, команда
.Dl Nm Fl c Fl f Pa new.tar Fl Fl include='*foo*' Cm @ Ns Pa old.tgz
создает новый архив
.Pa new.tar
содержащий только записи из
.Pa old.tgz
содержащие строку
.Sq foo .
.It Fl J , Fl Fl xz
(только c режим)
Сжимает полученный архив с помощью
.Xr xz 1 .
В режимах извлечения или списка, этот параметр игнорируется.
Обратите внимание, что эта
.Nm tar
реализация автоматически распознает сжатие XZ при чтении архивов.
.It Fl j , Fl Fl bzip , Fl Fl bzip2 , Fl Fl bunzip2
(только c режим)
Сжимает полученный архив с помощью
.Xr bzip2 1 .
В режимах извлечения или списка, этот параметр игнорируется.
Обратите внимание, что эта 
.Nm tar
реализация автоматически распознает сжатие bzip2 при чтении 
архивов.
.It Fl k , Fl Fl keep-old-files
(только x режим)
Не перезаписывать существующие файлы.
В частности, если файл появляется более одного раза в архиве,
поздние копии не перезаписывают более ранние копии.
.It Fl Fl keep-newer-files
(только x режим)
Не перезаписывать существующие файлы, которые новее,
чем версии, содержащиеся в извлекаемом архиве.
.It Fl L , Fl Fl dereference
(только c и r режимы)
Все символические ссылки будут разыменованы.
Обычно символические ссылки архивируются как таковые.
С этим параметром будет архивирована цель ссылки, а не сама ссылка.
.It Fl l , Fl Fl check-links
(только c и r режимы)
Выводить предупреждение, если не все ссылки на каждый файл архивированы.
.It Fl Fl lrzip
(только c режим)
Сжимает полученный архив с помощью
.Xr lrzip 1 .
В режимах извлечения или списка, этот параметр игнорируется.
Обратите внимание,что эта
.Nm tar
реализация автоматически распознает сжатие lr-zip при чтении
архивов.
.It Fl Fl lz4
(только c режим)
Сжимает архив с совместимым с lz4 сжатием перед записью.
В режимах извлечения или этого списка этот параметр игнорируется.
Обратите внимание,что эта
.Nm tar
реализация автоматически распознает сжатие lz4 при чтении архивов.
.It Fl Fl zstd
(только c режим)
Сжимает архив с совместимым с zstd сжатием перед записью.
В режимах извлечения или этого списка этот параметр игнорируется.
Обратите внимание,что эта
.Nm tar
реализация автоматически распознает сжатие zstd при чтении архивов.
.It Fl Fl lzma
(только c режим) Сжатие полученного архива с помощью оригинального LZMA алгоритма.
В режимах извлечения или этого списка эта опция игнорируется.
Использовать эту опцию не рекомендуется, и новые архивы следует создавать с помощью
.Fl Fl xz
вместо этого.
Обратите внимание,что эта
.Nm tar
реализация автоматически распознает сжатие LZMA при чтении архивов. 
.It Fl Fl lzop
(только c режим)
Сжатие полученного архива с помощью
.Xr lzop 1 .
В режимах извлечения или этого списка этот параметр игнорируется.
Обратите внимание,что эта
.Nm tar
реализация автоматически распознает сжатие LZO при чтении архивов. 
.It Fl m , Fl Fl modification-time
(только х режим)
Не извлекать время модификации.
По умолчанию время модификации устанавливается на время, хранящееся в архиве.
.It Fl Fl mac-metadata
(только c, r, u и x режимы)
Mac OS X specific.
Архивировать или извлекать расширенные ACL и расширенные атрибуты 
файлов,используя
.Xr copyfile 3
В AppleDouble формате.
Это противоположно
.Fl Fl no-mac-metadata .
и поведение по умолчанию в c, r, и u режимах и если
.Nm
запускается в x режиме от root.
.It Fl n , Fl Fl norecurse , Fl Fl no-recursion
Не выполнять рекурсивные операции над содержимым каталогов.
.It Fl Fl newer Ar date
(только c, r, u режимы)
Включать только файлы и каталоги, новее указанной даты. 
Сравниваются метки времени ctime.
.It Fl Fl newer-mtime Ar date
(только c, r, u режимы)
Как
.Fl Fl newer ,
за исключением того, что он сравнивает записи mtime вместо записей ctime.
.It Fl Fl newer-than Pa file
(только c, r, u режимы)
Включайте только файлы и каталоги, которые новее указанного файла.
При этом сравниваются записи ctime.
.It Fl Fl newer-mtime-than Pa file
(только c, r, u режимы)
Как
.Fl Fl newer-than ,
за исключением того, что он сравнивает записи mtime вместо записей ctime.
.It Fl Fl nodump
(только c и r режимы)
Соблюдайте флаг файла nodump, пропуская этот файл.
.It Fl Fl nopreserveHFSCompression
(только x режим)
Для Mac OS X (v10.6 or later). D Не сжимайте извлеченные обычные файлы, 
которые были сжаты с помощью сжатия HFS+ перед архивированием.
По умолчанию обычные файлы снова сжимаются с помощью сжатия HFS+.
.It Fl Fl null
(используйте с
.Fl I
или
.Fl T )
Имена файлов или шаблоны разделяются символами null,
а не символами новой строки.
Это часто используется для чтения имен файлов, выводимых 
.Fl print0
параметром в
.Xr find 1 .
.It Fl Fl no-acls
(только c, r, u, x режимы)
Не архивируйте и не извлекайте списки управления доступом POSIX.1e или NFSv4 ACLs.
Это противоположно
.Fl Fl acls
и поведение по умолчанию, если
.Nm
запущен от имени пользователя без прав root в x режиме (в Mac OS X как любой пользователь в c, r, u и x режимах).
.It Fl Fl no-fflags
(только c, r, u, x режимы)
Не архивируйте и не извлекайте атрибуты файла или флаги файлов.
Это противоположно
.Fl Fl fflags
и поведение по умолчанию, если
.Nm
запускается от имени пользователя, не являющегося пользователем root, в x режиме.
.It Fl Fl no-mac-metadata
(только x режим)
Для Mac OS X.
Не архивируйте и не извлекайте списки управления доступом и расширенные атрибуты файлов
с помощью
.Xr copyfile 3
в AppleDouble формате.
Это противоположно
.Fl Fl mac-metadata .
и поведение по умолчанию, если
.Nm
запускается не от имени пользователя root в x режиме.
.It Fl Fl no-read-sparse
(только c, r, u режимы)
Не считывает информацию о разреженных файлах с диска.
Это противоположно
.Fl Fl read-sparse .
.It Fl Fl no-safe-writes
(только х режим)
Не создавайте временные файлы и не используйте,
.Xr rename 2
чтобы заменить исходные файлы.
Это противоположно
.Fl Fl safe-writes .
.It Fl Fl no-same-owner
(только х режим)
Не извлекайте идентификаторы владельца и группы. 
Это противоположно
.Fl Fl same-owner
и поведение по умолчанию, если
.Nm
запущен не от имени root. 
.It Fl Fl no-same-permissions
(только х режим)
Не извлекайте полные разрешения (SGID, SUID, фиксированный бит,
атрибуты файла или флаги файла, расширенные атрибуты файла и ACLs).
Это противоположно
.Fl p
и поведение по умолчанию, если
.Nm
запущен не от имени root.
.It Fl Fl no-xattrs
(только c, r, u, x режимы)
Не архивируются и не извлекаются расширенные атрибуты файла. 
Это противоположно
.Fl Fl xattrs
и будет работать по умолчанию
.Nm
запущен не от имени root в x режиме.
.It Fl Fl numeric-owner
Это эквивалентно
.Fl Fl uname
.Qq
.Fl Fl gname
.Qq .
При извлечении имена пользователей и групп в архиве
игнорируются в пользу числовых идентификаторов пользователей и групп. 
При создании имена пользователей и групп не сохраняются
в архиве. 
.It Fl O , Fl Fl to-stdout
(только x, t режимы)
В режиме извлечения (-x) файлы будут записываться в стандартный вывод, а не
извлекаться на диск. 
В режиме списка (-t) список файлов будет записан в stderr, а не
в обычный стандартный вывод. 
.It Fl o
(x режим)
Используйте пользователя и группу пользователей, запускающих программу, а
не тех, которые указаны в архиве. 
Обратите внимание, что это не имеет значения, если только
.Fl p
не указан, и программа не запущена пользователем root. 
В этом случае режимы и флаги файлов из
архива будут восстановлены, но списки управления доступом или информация о владельце в
архиве будут удалены. 
.It Fl o
(c, r, u режимы)
Синоним для
.Fl Fl format Ar ustar
.It Fl Fl older Ar date
(только c, r, u режимы)
Включает только файлы и каталоги старше указанной даты. 
При этом сравниваются записи ctime. 
.It Fl Fl older-mtime Ar date
(только c, r, u режимы)
Как
.Fl Fl older ,
за исключением того, что он сравнивает записи mtime вместо записей ctime. 
.It Fl Fl older-than Pa file
(только c, r, u режимы)
Включаются только файлы и каталоги, более старые, чем указанный файл. 
При этом сравниваются записи ctime. 
.It Fl Fl older-mtime-than Pa file
(только c, r, u режимы)
Как
.Fl Fl older-than ,
за исключением того, что он сравнивает записи mtime вместо записей ctime.
.It Fl Fl one-file-system
(только c, r и u режимы)
Не пересекайте точки монтирования.
.It Fl Fl options Ar options
Выберите необязательные параметры поведения для определенных модулей.
Аргумент представляет собой текстовую строку, содержащую
ключевые слова и значения, разделенные запятыми.
Они передаются модулям, которые обрабатывают определенные
форматы, чтобы управлять поведением этих форматов.
Каждый параметр имеет одну из следующих форм:
.Bl -tag -compact -width indent
.It Ar key=value
Ключу будет присвоено указанное значение в каждом модуле, который его поддерживает.
Модули, которые не поддерживают этот ключ, будут игнорировать его.
.It Ar key
Ключ будет включен в каждом модуле, который его поддерживает.
Это эквивалентно
.Ar key Ns Cm =1 .
.It Ar !key
Ключ будет отключен в каждом модуле, который его поддерживает.
.It Ar module:key=value , Ar module:key , Ar module:!key
Как указано выше, но соответствующие ключ и значение будут предоставлены
только тем модулям, название которых совпадает с
.Ar module .
.El
.Pp
Полный список поддерживаемых модулей и ключей
для режимов создания и добавления приведен в
.Xr archive_write_set_options 3
а для режимов извлечения и составления списка - в
.Xr archive_read_set_options 3 .
.Pp
Примеры поддерживаемых опций:
.Bl -tag -compact -width indent
.It Cm iso9660:joliet
Поддержка расширений Joliet.
По умолчанию эта функция включена, используйте
.Cm !joliet
или
.Cm iso9660:!joliet
для отключения.
.It Cm iso9660:rockridge
Поддерживает расширения Rock Ridge.
По умолчанию эта функция включена, используйте
.Cm !rockridge
или
.Cm iso9660:!rockridge
для отключения.
.It Cm gzip:compression-level
Десятичное целое число от 1 до 9, указывающее уровень сжатия gzip.
.It Cm gzip:timestamp
Сохранять временную метку.
По умолчанию эта функция включена, используйте
.Cm !timestamp
или
.Cm gzip:!timestamp
для отключения.
.It Cm lrzip:compression Ns = Ns Ar type
Используйте
.Ar type
как метод сжатия.
Поддерживаемые значения это bzip2, gzip, lzo (сверхбыстрые),
и zpaq (наилучший, чрезвычайно медленный).
.It Cm lrzip:compression-level
Десятичное целое число от 1 до 9, указывающее уровень сжатия lrzip.
.It Cm lz4:compression-level
Десятичное целое число от 1 до 9, указывающее уровень сжатия lzop.
.It Cm lz4:stream-checksum
Включить потоковую контрольную сумму.
Это используется по умолчанию
.Cm lz4:!stream-checksum
для отключения.
.It Cm lz4:block-checksum
Включить контрольную сумму блока (по умолчанию отключена).
.It Cm lz4:block-size
Десятичное целое число от 4 до 7, задающее размер блока сжатия lz4
(по умолчанию установлено значение 7).
.It Cm lz4:block-dependence
Используйте предыдущий блок сжимаемого
блока в качестве словаря сжатия для улучшения степени сжатия.
.It Cm zstd:compression-level
Десятичное целое число, указывающее уровень сжатия по стандарту zstd. Поддерживаемые значения зависят
от версии библиотеки, обычно используются значения от 1 до 22.
.It Cm zstd:threads
Укажите количество используемых рабочих потоков.
Если задать для потоков специальное значение 0, то 
.Xr zstd 1
будет использовать столько потоков, сколько ядер процессора в системе.
.It Cm zstd:frame-per-file
Запускайте новый кадр сжатия в начале каждого файла в
архиве.
.It Cm zstd:min-frame-size Ns = Ns Ar N
В сочетании с
.Cm zstd:frame-per-file ,
не запускайте новый кадр сжатия, если текущий кадр не имеет размера не менее
.Ar N
байт.
.It Cm zstd:max-frame-size Ns = Ns Ar N
Запустите новый кадр сжатия, как только текущий кадр превысит
.Ar N
байт.
.It Cm lzop:compression-level
Уровень сжатия для lzop, десятичное целое число от 1 до 9.
.It Cm xz:compression-level
Уровень сжатия для xz, десятичное целое число от 0 до 9.
.It Cm xz:threads
Указывает количество рабочих потоков для использования. 
Установка threads в специальное значение 0 заставляет
.Xr xz 1
использовать столько потоков, сколько есть ядер CPU в системе.
.It Cm mtree: Ns Ar keyword
Модуль записи mtree позволяет указать, какие ключевые слова mtree 
будут включены в вывод. 
Поддерживаемые ключевые слова включают: 
.Cm cksum , Cm device , Cm flags , Cm gid , Cm gname , Cm indent ,
.Cm link , Cm md5 , Cm mode , Cm nlink , Cm rmd160 , Cm sha1 , Cm sha256 ,
.Cm sha384 , Cm sha512 , Cm size , Cm time , Cm uid , Cm uname .
По умолчанию эквивалентно:
.Dq device, flags, gid, gname, link, mode, nlink, size, time, type, uid, uname .
.It Cm mtree:all
Включает все вышеперечисленные ключевые слова.
Вы также можете
.Cm mtree:!all
отключить все ключевые слова.
.It Cm mtree:use-set
Включает генерацию
.Cm /set
строк в выводе.
.It Cm mtree:indent
Производит читаемый для человека вывод с отступами и разбивкой строк
для соответствия 80 столбцам.
.It Cm zip:compression Ns = Ns Ar type
Использование
.Ar type
метода сжатия.
Поддерживаемыми значениями являются store (без сжатия) и deflate (gzip алгоритм).
.It Cm zip:encryption
Включить шифрование с использованием традиционного шифрования zip.
.It Cm zip:encryption Ns = Ns Ar type
Использование
.Ar type
типа шифрования.
Поддерживаемыми значениями являются zipcrypt (традиционное zip шифрование),
aes128 (WinZip AES-128 шифрование) и aes256 (WinZip AES-256 шифрование).
.It Cm read_concatenated_archives
Игнорировать нулевые блоки в архиве, которые 
возникают при объединении нескольких tar-архивов. 
Без этой опции будет прочитано только содержимое 
первого объединенного архива.
Этот параметр аналогичен
.Fl i , Fl Fl ignore-zeros
параметру в GNU tar.
.El
Если предоставленный параметр не поддерживается каким-либо модулем, это
приводит к фатальной ошибке.
.It Fl P , Fl Fl absolute-paths
Сохранять абсолютные пути.
По умолчанию абсолютные пути (те, которые начинаются с символа /) 
имеют удаленный слэш как при создании архивов,
так и при извлечении из них.
Также,
.Nm
будет отказано в извлечении архивных записей, пути к которым содержат
.Pa ..
или целевой каталог которого может быть изменен с помощью символической ссылки.
Этот параметр запрещает такое поведение.
.It Fl p , Fl Fl insecure , Fl Fl preserve-permissions
(только x режим)
Сохранять права доступа к файлам. 
Пытаться восстановить полные права доступа, включая режимы файлов, атрибуты файлов
или флаги файла, расширенные атрибуты файла и ACL (если доступны) для каждого
извлеченного элемента из архива.
Это противоположно
.Fl Fl no-same-permissions
и используется по умолчанию,если
.Nm
запускается от root.
Это можно частично переопределить, также указав
.Fl Fl no-acls ,
.Fl Fl no-fflags ,
.Fl Fl no-mac-metadata
или
.Fl Fl no-xattrs .
.It Fl Fl passphrase Ar passphrase
Пароль
.Pa passphrase
используется для извлечения или создания зашифрованного архива.
В настоящее время формат zip единственный поддерживаемый формат, поддерживающий шифрование.
Вам не следует использовать этот параметр, если вы не понимаете, насколько
небезопасно
ее использование.
.It Fl Fl posix
(только c, r, u режимы)
Синоним для
.Fl Fl format Ar pax
.It Fl q , Fl Fl fast-read
(только x и t режимы)
Извлекать или перечислять только первую запись архива, которая соответствует каждому шаблону 
или операнду имени файла.
Выходить сразу после сопоставления каждого указанного шаблона или имени файла.
По умолчанию архив всегда читается до самого конца, поскольку
в нем может быть несколько записей с одинаковыми именами, и, по общему правилу,
более поздние записи перезаписывают более ранние.
Этот параметр предусмотрен для оптимизации производительности.
.It Fl Fl read-sparse
(только c, r, u режимы)
Читать информацию о разреженных файлах с диска. 
Это обратная
.Fl Fl no-read-sparse
и поведение по умолчанию.
.It Fl S
(только x режим)
Извлечь файлы как разреженные файлы.
Для каждого блока на диске сначала проверьте, содержит ли он только байты NULL, и пропустите 
его в противном случае.
Это работает аналогично параметру conv=sparse у команды dd.
.It Fl s Ar pattern
Изменить имена файла или элементов архива в соответствии с
.Pa pattern .
Шаблон имеет формат
.Ar /old/new/ Ns Op ghHprRsS
где
.Ar old
является основным регулярным выражением,
.Ar new
является строкой замены совпавшей части,
и необязательные завершающие буквы модифицируют
обработку замены.
Если
.Ar old
не найдено, шаблон пропускается.
Внутри
.Ar new ,
~ заменяется совпадением, \e1 до \e9 содержимым
соответствующей захваченной группы.
Необязательное завершение g указывает, что сопоставление должно продолжаться
после совпавшей части и остановиться на первом неподходящем шаблоне.
Необязательное завершение s указывает, что шаблон применяется к значению
символьных ссылок.
Необязательное завершение p указывает, что после успешной замены
оригинальное имя пути и новое имя пути должны быть напечатаны в
стандартный вывод ошибок.
Необязательные завершающие символы H, R или S подавляют замены
для целей жестких ссылок, обычных имен файлов или целей символьных ссылок,
соответственно.
Необязательные завершающие символы h, r или s активируют замены
для целей жестких ссылок, обычных имен файлов или целей символьных ссылок,
соответственно.
По умолчанию
.Ar hrs
что применяет замены ко всем именам.
В частности, никогда не нужно указывать h, r или s.
.It Fl Fl safe-writes
(только x режим)
Извлекать файлы атомарно.
По умолчанию
.Nm
удаляет оригинальный файл с тем же именем, что и извлеченный файл (если он
существует), а затем сразу создает его под тем же именем и пишет в
него.
В течение короткого периода времени приложения, пытающиеся получить доступ к файлу,
может не найти его или увидеть неполные результаты.
Если
.Fl Fl safe-writes
включен,
.Nm
сначала создает уникальный временный файл, затем пишет новое содержимое в
временный файл, и наконец переименовывает временный файл в конечное
имя атомарно с использованием
.Xr rename 2 .
Это гарантирует, что приложение, получающее доступ к файлу, будет видеть либо
старое содержимое, либо новое содержимое в любое время.
.It Fl Fl same-owner
(только x режим)
Извлечь идентификаторы владельца и группы.
Это обратное действие к
.Fl Fl no-same-owner
и поведение по умолчанию, если
.Nm
запущен от имени root.
.It Fl Fl strip-components Ar count
Удалить указанное количество ведущих элементов пути.
Пути с меньшим количеством элементов будут пропущены без предупреждения.
Обратите внимание, что путь редактируется после проверки шаблонов включения/исключения,
но перед проверкой безопасности.
.It Fl T Ar filename , Fl Fl files-from Ar filename
В x или t mode,
.Nm
будет читать список имен для извлечения из
.Pa filename .
В c режиме,
.Nm
будет читать имена для архивации из
.Pa filename .
Особенное имя
.Dq -C
на отдельной строке приведет к изменению текущего каталога на
каталог, указанный на следующей строке.
Имена завершаются символами новой строки, если 
.Fl Fl null
не указан.
Обратите внимание,что
.Fl Fl null
также отключает специальную обработку строк, содержащих
.Dq -C .
Примечание:  Если вы создаете списки файлов с помощью
.Xr find 1 ,
вам вероятно нужно использовать
.Fl n
также.
.It Fl Fl totals
(только c, r, u режимы)
После архивирования всех файлов вывести сводку в stderr.
.It Fl U , Fl Fl unlink , Fl Fl unlink-first
(только x режим)
Удалить файлы перед их созданием.
Это может быть незначительной оптимизацией производительности, если большинство файлов уже
существуют, но может замедлить процесс,
если большинство файлов еще не существуют.
Этот флаг также заставляет
.Nm
удалять промежуточные символические ссылки на каталоги вместо 
сообщения об ошибке.
См. раздел БЕЗОПАСНОСТЬ ниже для получения дополнительной информации.
.It Fl Fl uid Ar id
Использовать предоставленный идентификатор пользователя и игнорировать имя пользователя
из архива.
При создании,если 
.Fl Fl uname
не указано, имя пользователя, будет установлено так, чтобы соответствовать
идентификатору пользователя.
.It Fl Fl uname Ar name
Использовать предоставленное имя пользователя.
При извлечении это переопределяет имя пользователя в архиве; 
если предоставленное имя пользователя не существует в системе, 
оно будет проигнорировано, и вместо этого идентификатор пользователя
(из архива или из 
.Fl Fl uid
параметра)
будет использован.
При создании это устанавливает имя пользователя, которое будет сохранено
в архиве; 
имя не проверяется по базе данных пользователей системы.
.It Fl Fl use-compress-program Ar program
Перенаправить ввод (в режимах x или t) или вывод (в режиме c) через
.Pa program
вместо использования встроенной поддержки сжатия.
.It Fl v , Fl Fl verbose
Генерировать подробный вывод.
В режимах создания и извлечения
.Nm
будет перечислять каждое имя файла при его чтении из архива или записи 
в архив.
В режиме списка
.Nm
будет производить вывод, аналогичный выводу
.Xr ls 1 .
Дополнительный
.Fl v
также предоставит подобные ls детали в режимах создания и извлечения.
.It Fl Fl version
Вывести версию
.Nm
и
.Nm libarchive ,
и завершить работу.
.It Fl w , Fl Fl confirmation , Fl Fl interactive
Запрашивать подтверждение для каждого действия.
.It Fl X Ar filename , Fl Fl exclude-from Ar filename
Прочитать список шаблонов исключения из указанного файла.
См.
.Fl Fl exclude
для получения дополнительной информации о обработке исключений.
.It Fl Fl xattrs
(только c, r, u, x режимы)
Архивировать или извлечь расширенные атрибуты файлов.
Это противоположное действие к
.Fl Fl no-xattrs
и поведение по умолчанию в режимах c, r, u или если
.Nm
запущен в режиме x от имени root.
.It Fl y
(только c режим)
Сжать полученный архив с помощью
.Xr bzip2 1 .
В режимах извлечения или списка этот параметр игнорируется.
Обратите внимание, что эта 
.Nm tar
реализация автоматически распознает сжатие bzip2 при чтении
архивов.
.It Fl Z , Fl Fl compress , Fl Fl uncompress
(только c режим)
Сжать полученный архив с помощью
.Xr compress 1 .
В режимах извлечения или списка этот параметр игнорируется.
Обратите внимание, что эта 
.Nm tar
реализация автоматически распознает сжатие compress при чтении 
архивов.
.It Fl z , Fl Fl gunzip , Fl Fl gzip
(только c режим)
Сжать полученный архив с помощью
.Xr gzip 1 .
В режимах извлечения или списка этот параметр игнорируется.
Обратите внимание, что эта 
.Nm tar
реализация автоматически распознает сжатие gzip при чтении
архивов.
.El
.Sh ОКРУЖЕНИЕ
Следующие переменные окружения влияют на выполнение
.Nm :
.Bl -tag -width indent
.It Ev TAR_READER_OPTIONS
Стандартные параметры для считывателей формата и сжатия.
Параметр
.Fl Fl options
переопределяет это.
.It Ev TAR_WRITER_OPTIONS
Стандартные параметры для записывателей формата и сжатия.
Параметр
.Fl Fl options
переопределяет это.
.It Ev LANG
Локаль для использования.
См.
.Xr environ 7
для получения дополнительной информации.
.It Ev TAPE
Устройство по умолчанию.
Параметр
.Fl f
переопределяет это.
Пожалуйста, ознакомьтесь с описанием
.Fl f
параметра выше для получения дополнительных подробностей..
.It Ev TZ
Часовой пояс для отображения дат.
См.
.Xr environ 7
для получения дополнительной информации.
.El
.Sh СТАТУС ВЫХОДА
.Ex -std
.Sh ПРИМЕРЫ
Следующее создает новый архив
с именем
.Ar file.tar.gz
с двумя файлами
.Ar source.c
и
.Ar source.h :
.Dl Nm Fl czf Pa file.tar.gz Pa source.c Pa source.h
.Pp
Для просмотра подробного содержимого этого
архива:
.Dl Nm Fl tvf Pa file.tar.gz
.Pp
Для извлечения всех записей из архива на
стандартном ленточном приводе:
.Dl Nm Fl x
.Pp
Для изучения содержимого ISO 9660 cdrom образа:
.Dl Nm Fl tf Pa image.iso
.Pp
Чтобы переместить файловые иерархии, вызовите
.Nm
as
.Dl Nm Fl cf Pa - Fl C Pa srcdir \&. | Nm Fl xpf Pa - Fl C Pa destdir
или более традиционно
.Dl cd srcdir \&; Nm Fl cf Pa - \&. | ( cd destdir \&; Nm Fl xpf Pa - )
.Pp
В режиме создания список файлов и каталогов для архивирования также
может включать инструкции изменения каталога в форме
.Cm -C Ns Pa foo/baz
и включения архива в форме
.Cm @ Ns Pa archive-file .
Например, команда
.Dl Nm Fl c Fl f Pa new.tar Pa foo1 Cm @ Ns Pa old.tgz Cm -C Ns Pa /tmp Pa foo2
will create a new archive
.Pa new.tar .
.Nm
прочитает файл
.Pa foo1
из текущего каталога и добавит его в выходной архив. 
Затем он прочитает каждую запись из
.Pa old.tgz
и добавит эти записи в выходной архив.
Наконец, он переключится в 
.Pa /tmp
каталог и добавит
.Pa foo2
в выходной архив.
.Pp
Входной файл в
.Xr mtree 5
формате можно использовать для создания выходного архива с произвольным владельцем,
разрешениями или именами, отличающимися от существующих данных на диске:
.Bd -literal -offset indent
$ cat input.mtree
#mtree
usr/bin uid=0 gid=0 mode=0755 type=dir
usr/bin/ls uid=0 gid=0 mode=0755 type=file content=myls
$ tar -cvf output.tar @input.mtree
.Ed
.Pp
Параметры
.Fl Fl newer
и
.Fl Fl newer-mtime
принимают различные общие спецификации даты и времени, включая 
.Dq 12 Mar 2005 7:14:29pm ,
.Dq 2005-03-12 19:14 ,
.Dq 5 minutes ago ,
и
.Dq 19:14 PST May 1 .
.Pp
Аргумент
.Fl Fl options
может использоваться для управления различными деталями генерации
или чтения архива.
Например, вы можете создать вывод mtree, который содержит только
.Cm type , Cm time ,
и
.Cm uid
ключевые слова:
.Dl Nm Fl cf Pa file.tar Fl Fl format=mtree Fl Fl options='!all,type,time,uid' Pa dir
или установить уровень сжатия, используемый сжатием gzip или xz:
.Dl Nm Fl czf Pa file.tar Fl Fl options='compression-level=9' .
Для более подробной информации о параметрах смотрите 
.Fn archive_read_set_options
и
.Fn archive_write_set_options
API вызовов,описанных в
.Xr archive_read 3
и
.Xr archive_write 3 .
.Sh CОВМЕСТИМОСТЬ
Формат передачи аргументов в виде пакета поддерживается для обеспечения совместимости 
с историческими реализациями.
Он состоит из начального слова (без ведущего символа -), 
в котором каждый символ указывает на опцию. 
Аргументы следуют как отдельные слова.
Порядок аргументов должен соответствовать порядку 
соответствующих символов в начальном слове команды пакета.
Например,
.Dl Nm Cm tbf 32 Pa file.tar
указывает на три флага
.Cm t ,
.Cm b ,
И
.Cm f .
Флаги
.Cm b
и
.Cm f
требуют аргументы,
поэтому должно быть два дополнительных элемента
на командной строке.
The
.Ar 32
это аргумент для
.Cm b
флага, а
.Ar file.tar
аргумент для
.Cm f
флага.
.Pp
Параметры режимов c, r, t, u, и x и параметры
b, f, l, m, o, v, и w соответствуют SUSv2.
.Pp
Для максимальной переносимости скриптов, вызывающих
.Nm tar
следует использовать указанный формат передачи аргументов в виде пакета выше,
ограничивая себя 
.Cm c ,
.Cm t ,
и
.Cm x
режимами, а также
.Cm b ,
.Cm f ,
.Cm m ,
.Cm v ,
и
.Cm w
параметрами.
.Pp
Предоставляются дополнительные длинные опции для улучшения совместимости с другими 
реализациями tar.
.Sh БЕЗОПАСНОСТЬ
Некоторые проблемы безопасности характерны для многих программ архивации, включая
.Nm .
Особенно тщательно созданные архивы могут требовать
.Nm
извлечения файлов вне целевого каталога. 
Это может потенциально привести к перезаписи 
файлов, которые пользователь не намерен перезаписать.
Если архив извлекается суперпользователем, любой 
файл на системе может быть перезаписан.
Это может произойти тремя способами.
Хотя в
.Nm
есть механизмы защиты от каждого из них,
опытные пользователи должны знать о последствиях:
.Bl -bullet -width indent
.It
У записей архива могут быть абсолютные пути.
По умолчанию,
.Nm
удаляет начальный
.Pa /
символ из имен файлов перед их восстановлением для предотвращения этой проблемы.
.It
У записей архива могут быть пути, включающие
.Pa ..
компоненты.
По умолчанию,
.Nm
не будет извлекать файлы, содержащие
.Pa ..
путь к компонентам.
.It
Записи архива могут использовать символические ссылки для восстановления
файлов в других каталогах.
Архив может восстановить символическую ссылку на другой каталог,
а затем использовать эту ссылку для восстановления файла в этом каталоге.
Чтобы избежать этого,
.Nm
проверяет каждый извлеченный путь на наличие символических ссылок.
Если конечным элементом пути является символическая ссылка, он будет удален
и заменен на архивную запись.
Если
.Fl U
указан, любая промежуточная символическая ссылка также будет удалена безоговорочно.
Если ни
.Fl U
ни
.Fl P
указаны,
.Nm
откажется извлекать запись.
.El
Для защиты от этого следует быть осторожным с архивами
из ненадежных источников.
Рекомендуется проверять содержимое архива 
.Dl Nm Fl tf Pa filename
перед извлечением.
Следует использовать
.Fl k
параметр, чтобы предотвратить
.Nm
перезапись существующих файлов или 
.Fl U
параметр для удаления предварительно существующих файлов.
Обычно не следует извлекать архивы с привилегиями 
суперпользователя.
Обратите внимание, что 
.Fl P
параметр для
.Nm
отключает вышеуказанные проверки безопасности и позволяет извлекать
архив, сохраняя при этом любые абсолютные пути,
.Pa ..
компоненты, или символические ссылки на другие каталоги.
.Sh СМ. ТАКЖЕ
.Xr bzip2 1 ,
.Xr compress 1 ,
.Xr cpio 1 ,
.Xr gzip 1 ,
.Xr mt 1 ,
.Xr pax 1 ,
.Xr shar 1 ,
.Xr xz 1 ,
.Xr libarchive 3 ,
.Xr libarchive-formats 5 ,
.Xr tar 5
.Sh СТАНДАРТЫ
На данный момент не существует стандарта POSIX для команды tar; она появилась
в
.St -p1003.1-96
но была исключена из
.St -p1003.1-2001 .
Поддерживаемые этой реализацией параметра были разработаны путем изучения 
нескольких существующих реализаций tar, а также старой спецификации POSIX 
для tar и текущей спецификации POSIX для pax.
.Pp
Форматы файлов для обмена данными ustar и pax определены в
.St -p1003.1-2001
для команды pax.
.Sh ИСТОРИЯ
Команда
.Nm tar
появилась в Seventh Edition Unix, выпущенной в январе 1979 года.
Существует множество других реализаций,
многие из которых расширили формат файла. 
Джон Гилмор
.Nm pdtar
реализация общественного достояния (примерно ноябрь 1987 года)
оказала значительное влияние и послужила основой для GNU tar.
GNU tar был включен как стандартный системный tar 
в
.Fx
начале версии
.Fx 1.0 .
.Pp
Это полное переосмысление, основанное на
.Xr libarchive 3
библиотеке.
Первоначально был выпущен с версией
.Fx 5.4
В мае 2005 года.
.Sh БАГИ
Эта программа следует стандарту
.St -p1003.1-96
для определения 
.Fl l
опции.
Обратите внимание, что GNU tar до версии 1.15 рассматривал
.Fl l
как синоним 
.Fl Fl one-file-system
параметра.
.Pp
Параметр
.Fl C Pa dir
может отличаться от исторических реализаций.
.Pp
Весь архивный вывод записывается в блоках правильного размера,
даже если вывод сжимается. 
Независимо от того, будет ли последний блок вывода дополнен до полного 
размера блока, это зависит от формата и 
устройства вывода.
Для форматов tar и cpio последний блок вывода дополняется до полного
размера блока, если вывод осуществляется на 
стандартный вывод или на устройство символьного или блочного устройства, такое как 
ленточный привод. 
Если вывод осуществляется в обычный файл, последний блок 
не будет дополнен.
Многие компрессоры, включая
.Xr gzip 1
и
.Xr bzip2 1 ,
жалуются на нулевое дополнение при разархивации архива, созданного
.Nm ,
хотя они все равно извлекают его правильно.
.Pp
Сжатие и разжатие реализовано внутренне, поэтому 
могут быть незначительные различия между сжатым выводом,
созданным с помощью
.Dl Nm Fl czf Pa - file
и тем, созданным с помощью
.Dl Nm Fl cf Pa - file | Nm gzip
.Pp
По умолчанию следует читать и записывать архивы на стандартные пути ввода-вывода, 
однако традиция (и POSIX) диктует иначе.
.Pp
Режимы
.Cm r
и
.Cm u
требуют, чтобы архив был несжатым и 
находился в обычном файле на диске.
Другие архивы можно изменять 
.Cm c
с помощью режима с
.Pa @archive-file
расширением.
.Pp
Для архивирования файла с именем
.Pa @foo
или
.Pa -foo
вы должны указать его как
.Pa ./@foo
или
.Pa ./-foo ,
соответственно.
.Pp
В режиме создания ведущий
.Pa ./
всегда удаляется. 
Ведущий 
.Pa /
удаляется, если
.Fl P
параметр не указан.
.Pp
Необходима лучшая поддержка выбора файлов как при создании, так 
и при извлечении.
.Pp
Пока нет поддержки многотомных архивов.
.Pp
Конвертация между различными форматами архивов (например, tar и cpio) с использованием
.Cm @ Ns Pa -
соглашение может привести к потере информации о жестких ссылках. 
(Это следствие несовместимых способов хранения информации о жестких ссылках в различных
форматах архивов).
