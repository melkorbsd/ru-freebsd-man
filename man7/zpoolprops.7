.\"
.\" CDDL HEADER START
.\"
.\" The contents of this file are subject to the terms of the
.\" Common Development and Distribution License (the "License").
.\" You may not use this file except in compliance with the License.
.\"
.\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
.\" or https://opensource.org/licenses/CDDL-1.0.
.\" See the License for the specific language governing permissions
.\" and limitations under the License.
.\"
.\" When distributing Covered Code, include this CDDL HEADER in each
.\" file and include the License file at usr/src/OPENSOLARIS.LICENSE.
.\" If applicable, add the following below this CDDL HEADER, with the
.\" fields enclosed by brackets "[]" replaced with your own identifying
.\" information: Portions Copyright [yyyy] [name of copyright owner]
.\"
.\" CDDL HEADER END
.\"
.\" Copyright (c) 2007, Sun Microsystems, Inc. All Rights Reserved.
.\" Copyright (c) 2012, 2018 by Delphix. All rights reserved.
.\" Copyright (c) 2012 Cyril Plisko. All Rights Reserved.
.\" Copyright (c) 2017 Datto Inc.
.\" Copyright (c) 2018 George Melikov. All Rights Reserved.
.\" Copyright 2017 Nexenta Systems, Inc.
.\" Copyright (c) 2017 Open-E, Inc. All Rights Reserved.
.\" Copyright (c) 2021, Colm Buckley <colm@tuatha.org>
.\" Copyright (c) 2023, Klara Inc.
.\"
.Dd April 18, 2023
.Dt ZPOOLPROPS 7
.Os
.
.Sh ИМЯ
.Nm zpoolprops
.Nd свойства пулов хранения ZFS
.
.Sh ОПИСАНИЕ
С каждым пулом связано несколько свойств.
Некоторые свойства доступны только для чтения, в то время как другие настраиваются и
изменяют поведение пула.
.Pp
Пользовательские свойства не влияют на поведение ZFS.
Используйте их для аннотирования пулов так, чтобы это имело смысл в вашей среде.
Дополнительные сведения о пользовательских свойствах смотрите в разделе
.Sx User Properties .
.Pp
Следующие свойства доступны только для чтения:
.Bl -tag -width "unsupported@guid"
.It Sy allocated
Объем хранилища, используемого в пуле.
Смотрите
.Sy fragmentation
и
.Sy free
для получения дополнительной информации.
.It Sy bcloneratio
Отношение общего объема хранилища, который потребовался бы для хранения всех
клонированных блоков без клонирования, к фактически используемому объему хранилища.
Свойство
.Sy bcloneratio
рассчитывается как:
.Pp
.Sy ( ( bclonesaved + bcloneused ) * 100 ) / bcloneused
.It Sy bclonesaved
Объем дополнительного хранилища, который потребовался бы, если
бы не использовалось блочное клонирование.
.It Sy bcloneused
Объем памяти, используемый клонированными блоками.
.It Sy capacity
Процент используемого пространства в пуле.
На это свойство также можно ссылаться по его сокращенному названию в столбце,
.Sy cap .
.It Sy expandsize
Объем неинициализированного пространства в пуле или на устройстве, который можно использовать для
увеличения общей емкости пула.
В vdevs на всем диске это пространство за пределами конца протокола GPT –
обычно это происходит при динамическом расширении LUN
или замене диска на диск большего размера.
В vdevs разделов это пространство, добавленное к разделу после его
добавления в пул – скорее всего, путем изменения его размера на месте.
Место для бассейна можно использовать, подключив его к сети с помощью
.Sy autoexpand=on
или используя
.Nm zpool Cm online Fl e .
.It Sy fragmentation
Степень фрагментации в пуле.
По мере увеличения объема пространства
.Sy allocated ,
становится все труднее найти свободное место
.Sy free .
Это может привести к снижению производительности записи по сравнению с пулами с большим
количеством нефрагментированного свободного пространства.
.It Sy free
Количество свободного места в бассейне.
В отличие от этого, свойство
.Xr zfs 8
.Sy available
описывает, сколько новых данных может быть записано в файловые системы/тома ZFS.
Свойство zpool
.Sy free
нецелесообразно для этой цели и может быть значительно больше,
чем пространство zfs
.Sy available .
Это несоответствие обусловлено несколькими факторами, в том числе паритетом raidz;
свойствами резервирования, квоты, обновления и повторной цитаты в zfs; и пространством,
отведенным
.Sy spa_slop_shift
(смотрите
.Xr zfs 4
для получения дополнительной информации).
.It Sy freeing
После уничтожения файловой системы или моментального снимка пространство, которое она использовала,
возвращается в пул асинхронно.
.Sy freeing
это количество свободного места, которое еще предстоит освободить.
Со временем
.Sy freeing
будет уменьшаться, пока увеличивается
.Sy free .
.It Sy guid
Уникальный идентификатор для пула.
.It Sy health
Текущее состояние бассейна.
Состояние может быть одним из следующих:
.Sy ONLINE , DEGRADED , FAULTED , OFFLINE, REMOVED , UNAVAIL .
.It Sy leaked
Пространство, не освобожденное во время
.Sy freeing
из-за коррупции теперь постоянно просачивается в пул.
.It Sy load_guid
Уникальный идентификатор для пула.
В отличие от свойства
.Sy guid ,
этот идентификатор генерируется каждый раз, когда мы загружаем пул (т.е.
не сохраняется при импорте/экспорте) и никогда не изменяется во время загрузки пула
(даже если операция
.Sy reguid
происходит).
.It Sy size
Общий размер хранилища пула.
.It Sy unsupported@ Ns Em guid
Информация о неподдерживаемых функциях, которые включены в пуле.
Смотрите
.Xr zpool-features 7
для получения подробной информации.
.El
.Pp
Свойства использования пространства отображают фактическое физическое пространство, доступное для
пула хранения.
Физическое пространство может отличаться от общего объема пространства, который
могут фактически использовать любые содержащиеся в нем наборы данных.
Объем пространства, используемого в конфигурации raidz, зависит от характеристик
записываемых данных.
Кроме того, ZFS резервирует некоторое пространство для внутреннего учета, которое команда
.Xr zfs 8
принимает во внимание, но при этом команда
.Nm
нет.
Для неполных пулов разумного размера эти эффекты должны быть незаметны.
Для небольших пулов или пулов, которые близки к полному заполнению, эти
расхождения могут стать более заметными.
.Pp
Во время создания и импорта можно задать следующее свойство:
.Bl -tag -width Ds
.It Sy altroot
Альтернативный корневой каталог.
Если задан, этот каталог добавляется ко всем точкам подключения в пуле.
Это можно использовать при проверке неизвестного пула, где точкам подключения нельзя
доверять, или в альтернативной среде загрузки, где обычные пути
недопустимы.
Свойство
.Sy altroot
не является постоянным.
Оно действует только во время работы системы.
При установке
.Sy altroot
по умолчанию используется значение
.Sy cachefile Ns = Ns Sy none ,
хотя это может быть переопределено с помощью явного параметра.
.El
.Pp
Следующее свойство может быть установлено только во время импорта:
.Bl -tag -width Ds
.It Sy readonly Ns = Ns Sy on Ns | Ns Sy off
Если установлено значение
.Sy on ,
пул будет импортирован в режиме только для чтения.
На это свойство также можно ссылаться по его сокращенному названию столбца,
.Sy rdonly .
.El
.Pp
Следующие свойства могут быть установлены во время создания и импорта, а затем
изменены с помощью команды
.Nm zpool Cm set :
.Bl -tag -width Ds
.It Sy ashift Ns = Ns Ar ashift
Показатель размера сектора пула, в зависимости от
.Sy 2
(внутренне именуемый
.Sy ashift ) .
Допустимы значения от 9 до 16 включительно; кроме того,
значение 0 (по умолчанию) означает автоматическое определение с использованием уровня блоков ядра
и внутреннего списка исключений ZFS.
Операции ввода-вывода будут выровнены по указанным границам размера.
Кроме того, минимальный размер (для диска)
для записи будет установлен на указанный размер, что соответствует
соотношению объема памяти и производительности.
Для достижения оптимальной производительности размер сектора пула должен быть больше
или равен размеру сектора базовых дисков.
Типичным случаем установки этого свойства является ситуация, когда
важна производительность и на базовых дисках используются сектора размером 4 КБ, но
сообщайте о секторах 512B операционной системе (по соображениям совместимости); в этом
случае установите
.Sy ashift Ns = Ns Sy 12
(которое
.Sy 1<<12 No = Sy 4096 ) .
Если это свойство задано,
оно используется в качестве значения подсказки по умолчанию в последующих операциях vdev (добавление,
присоединение и замена).
Изменение этого значения не изменит существующий
vdev, даже при замене диска; однако его можно использовать,
например, для замены устаревшего диска с секторами 512B на более новое
устройство с секторами 4KiB: это, вероятно, приведет к снижению производительности, но в то
же время может предотвратить потерю данных.
.It Sy autoexpand Ns = Ns Sy on Ns | Ns Sy off
Управляет автоматическим расширением пула при увеличении базового LUN.
Если установлено значение
.Sy on ,
размер пула будет изменен в соответствии с размером расширенного устройства.
Если устройство является частью зеркальной или raidz-группы, то все устройства в этой
зеркальной/raid-группе должны быть расширены, прежде чем новое пространство станет доступным для
пула.
По умолчанию установлено
.Sy off .
На это свойство также можно ссылаться по его сокращенному названию столбца,
.Sy expand .
.It Sy autoreplace Ns = Ns Sy on Ns | Ns Sy off
Управляет автоматической заменой устройства.
Если установлено значение
.Sy off ,
замена устройства должна быть инициирована администратором с помощью команды
.Nm zpool Cm replace .
Если установлено значение
.Sy on ,
любое новое устройство, обнаруженное в том же физическом местоположении, что и устройство, ранее
принадлежавшее пулу, автоматически форматируется и заменяется.
По умолчанию используется
.Sy off .
На это свойство также можно ссылаться по его сокращенному названию столбца,
.Sy replace .
Автозамена также может использоваться с виртуальными дисками (например, device
mapper) при условии, что вы используете пути /dev/disk/by-vdev, настроенные с помощью
vdev_id.conf.
Смотрите страницу руководства
.Xr vdev_id 8
для получения более подробной информации.
Для автозамены и автоматического подключения к сети требуется, чтобы демон событий ZFS был настроен и
запущен.
Смотрите страницу руководства
.Xr zed 8
для получения более подробной информации.
.It Sy autotrim Ns = Ns Sy on Ns | Ns Sy off
Когда установлено значение
.Sy on
пространство, которое было недавно освобождено и больше не выделяется пулом,
будет периодически сокращаться.
Это позволяет блокировать vdevs устройств, поддерживающие
BLKDISCARD, такие как твердотельные накопители или файловые vdevs, на которых базовая файловая система
поддерживает пробивку отверстий, для освобождения неиспользуемых блоков.
Значение по умолчанию для этого свойства равно
.Sy off .
.Pp
Автоматическая ОБРЕЗКА не приводит к немедленному восстановлению блоков после освобождения.
Вместо этого она, как правило, задерживает объединение меньших диапазонов
в несколько более крупных.
Затем они могут быть более эффективно переданы в хранилище.
ОБРЕЗКА на устройствах L2ARC включается с помощью настройки
.Sy l2arc_trim_ahead > 0 .
.Pp
Имейте в виду, что автоматическое удаление недавно освобожденных блоков данных может привести
к существенной нагрузке на базовые устройства хранения.
Это зависит от того, насколько хорошо конкретное устройство справляется с этими командами.
Для устройств более низкого уровня часто можно добиться большинства преимуществ
автоматической обрезки, периодически выполняя обрезку по требованию (вручную)
с помощью команды
.Nm zpool Cm trim .
.It Sy bootfs Ns = Ns Sy (unset) Ns | Ns Ar pool Ns Op / Ns Ar dataset
Определяет набор загрузочных данных по умолчанию для корневого пула.
Ожидается, что это свойство будет устанавливаться в основном программами установки и обновления.
Не все процессы загрузки дистрибутива Linux используют свойство bootfs.
.It Sy cachefile Ns = Ns Ar path Ns | Ns Sy none
Определяет местоположение, в котором кэшируется конфигурация пула.
Для обнаружения всех пулов при запуске системы требуется кэшированная копия
данных конфигурации, которая хранится в корневой файловой системе.
Все пулы в этом кэше автоматически импортируются при загрузке системы.
В некоторых средах, таких как установка и кластеризация, необходимо кэшировать эту
информацию в другом месте, чтобы пулы не
импортировались автоматически.
При установке этого свойства конфигурация пула кэшируется в другом месте, которое
впоследствии можно импортировать с помощью
.Nm zpool Cm import Fl c .
При установке значения
.Sy none
создает временный пул, который никогда не кэшируется, и
.Qq
.Pq пустая строка
использует местоположение по умолчанию.
.Pp
Несколько пулов могут совместно использовать один и тот же файл кэша.
Поскольку ядро уничтожает и воссоздает этот файл при добавлении и
удалении пулов, следует соблюдать осторожность при попытке доступа к этому файлу.
Когда последний пул, использующий
.Sy cachefile
если файл будет экспортирован или уничтожен, он будет пустым.
.It Sy comment Ns = Ns Ar text
Текстовая строка, состоящая из печатных символов ASCII, которая будет сохранена
таким образом, чтобы быть доступной даже в случае сбоя в работе пула.
Администратор может предоставить дополнительную информацию о пуле, используя это
свойство.
.It Sy compatibility Ns = Ns Sy off Ns | Ns Sy legacy Ns | Ns Ar file Ns Oo , Ns Ar file Oc Ns …
Указывает, что пул поддерживает совместимость с определенными наборами функций.
Если установлено значение
.Sy off
(или не установлена) совместимость отключена (все функции могут быть включены); если установлено значение
.Sy legacy Ns
никакие функции не могут быть включены.
Если задан список имен файлов, разделенных запятыми
(каждое имя файла может быть либо абсолютным путем, либо относительным к
.Pa /etc/zfs/compatibility.d
или
.Pa /usr/share/zfs/compatibility.d )
списки запрашиваемых функций считываются из этих файлов, разделенных
пробелами и/или запятыми.
Могут быть включены только те функции, которые присутствуют во всех файлах.
.Pp
Смотрите
.Xr zpool-features 7 ,
.Xr zpool-create 8
и
.Xr zpool-upgrade 8
для получения дополнительной информации о работе наборов функций совместимости.
.It Sy dedupditto Ns = Ns Ar number
Это свойство устарело и больше не имеет никакого эффекта.
.It Sy delegation Ns = Ns Sy on Ns | Ns Sy off
Определяет, предоставляется ли доступ непривилегированному пользователю на основе
разрешений, определенных для набора данных.
Смотрите
.Xr zfs 8
для получения дополнительной информации о делегированном администрировании ZFS.
.It Sy failmode Ns = Ns Sy wait Ns | Ns Sy continue Ns | Ns Sy panic
Управляет поведением системы в случае аварийного сбоя в работе пула.
Это состояние обычно возникает в результате потери подключения к базовому
устройству хранения данных или сбоя во всех устройствах в пуле.
Поведение такого события определяется следующим образом:
.Bl -tag -width "continue"
.It Sy wait
Блокирует весь доступ к вводу-выводу до тех пор, пока подключение устройства не будет восстановлено и ошибки
не будут устранены с помощью
.Nm zpool Cm clear .
Это поведение по умолчанию.
.It Sy continue
Возвращает
.Er EIO
на любые новые запросы ввода-вывода на запись, но разрешает чтение с любого из оставшихся исправных
устройств.
Любые запросы на запись, которые еще не были зафиксированы на диске, будут заблокированы.
.It Sy panic
Выводит сообщение на консоль и генерирует системный аварийный дамп.
.El
.It Sy feature@ Ns Ar feature_name Ns = Ns Sy enabled
Значением этого свойства является текущее состояние
.Ar feature_name .
Единственным допустимым значением при установке этого свойства является
.Sy enabled
который переводит
.Ar feature_name
во включенное состояние
Смотрите
.Xr zpool-features 7
для получения подробной информации о состояниях функций.
.It Sy listsnapshots Ns = Ns Sy on Ns | Ns Sy off
Определяет, выводится ли информация о моментальных снимках, связанных с этим пулом,
при запуске
.Nm zfs Cm list
без использования параметра
.Fl t .
Значение по умолчанию равно
.Sy off .
На это свойство также можно ссылаться по его сокращенному названию,
.Sy listsnaps .
.It Sy multihost Ns = Ns Sy on Ns | Ns Sy off
Определяет, следует ли выполнять проверку активности пула во время
.Nm zpool Cm import .
Когда пул определен как активный, он не может быть импортирован, даже при наличии опции
.Fl f .
Это свойство предназначено для использования в конфигурациях отработки
отказа, где несколько хостов имеют доступ к пулу в общем хранилище.
.Pp
Мультихостинг обеспечивает защиту только при импорте.
Он не защищает от
использования отдельного устройства в нескольких пулах, независимо от типа vdev.
Смотрите обсуждение в разделе
.Nm zpool Cm create .
.Pp
Когда это свойство включено, происходят периодические записи в хранилище, чтобы показать, что пул
используется.
Смотрите
.Sy zfs_multihost_interval
на странице руководства
.Xr zfs 4 .
Чтобы включить это свойство, каждый хост должен установить уникальный номер хостинга.
Смотрите
.Xr genhostid 1
.Xr zgenhostid 8
.Xr spl 4
для получения дополнительной информации.
Значение по умолчанию равно
.Sy off .
.It Sy version Ns = Ns Ar version
Текущая версия пула на диске.
Это значение может быть увеличено, но не уменьшено.
Предпочтительным способом обновления пулов является команда
.Nm zpool Cm upgrade ,
хотя это свойство можно использовать, когда для
обеспечения обратной совместимости требуется конкретная версия.
Как только в пуле будут включены флаги функций, это свойство больше не будет иметь
значения.
.El
.
.Ss User Properties
В дополнение к стандартным собственным свойствам, ZFS поддерживает произвольные пользовательские
свойства.
Пользовательские свойства не влияют на поведение ZFS, но приложения или
администраторы могут использовать их для аннотирования пулов.
.Pp
Имена пользовательских свойств должны содержать символ двоеточия
.Pq Qq Sy \&:
чтобы отличать их от собственных свойств.
Они могут содержать строчные буквы, цифры и следующие
знаки препинания: двоеточие
.Pq Qq Sy \&: ,
тире
.Pq Qq Sy - ,
точка
.Pq Qq Sy \&. ,
и нижнее подчеркивание
.Pq Qq Sy _ .
Ожидаемое соглашение заключается в том, что имя свойства делится на две части
, такие как
.Ar модуль : Ns Ar свойство ,
но это пространство имен не поддерживается ZFS.
Имена пользовательских свойств могут содержать не более 256 символов и не могут начинаться с тире
.Pq Qq Sy - .
.Pp
При программном использовании пользовательских свойств настоятельно рекомендуется использовать
обратное доменное имя DNS для компонента
.Ar модуль
из имен свойств, чтобы уменьшить вероятность того, что два
независимо разработанных пакета будут использовать одно и то же имя свойства для разных
целей.
.Pp
Значения пользовательских свойств являются произвольными строками и
никогда не проверяются.
Все команды, которые работают со свойствами
.Po Nm zpool Cm list ,
.Nm zpool Cm get ,
.Nm zpool Cm set ,
и так далее
.Pc
может использоваться для управления как собственными, так и пользовательскими свойствами.
Используйте
.Nm zpool Cm set Ar name Ns =
чтобы очистить пользовательское свойство.
Значения свойств ограничены 8192 байтами.
